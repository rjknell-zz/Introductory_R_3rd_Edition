<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 10 R graphics II — Adding elements to an existing graph | Introductory R: A beginner’s guide to programming, data visualisation and statistical analysis in R</title>
  <meta name="description" content="null" />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 10 R graphics II — Adding elements to an existing graph | Introductory R: A beginner’s guide to programming, data visualisation and statistical analysis in R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="null" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 10 R graphics II — Adding elements to an existing graph | Introductory R: A beginner’s guide to programming, data visualisation and statistical analysis in R" />
  
  <meta name="twitter:description" content="null" />
  

<meta name="author" content="Rob Knell" />


<meta name="date" content="2020-07-29" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="r-graphics-i-drawing-graphs-and-changing-plot-symbols-and-colours-using-the-base-graphics-system.html"/>
<link rel="next" href="graphics-with-ggplot2.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Introductory R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preface</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#why-this-book"><i class="fa fa-check"></i><b>1.1</b> Why this book?</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#how-to-use-this-book"><i class="fa fa-check"></i><b>1.2</b> How to use this book</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i><b>1.3</b> Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="a-first-r-session.html"><a href="a-first-r-session.html"><i class="fa fa-check"></i><b>2</b> A first R session</a><ul>
<li class="chapter" data-level="2.1" data-path="a-first-r-session.html"><a href="a-first-r-session.html#what-is-r"><i class="fa fa-check"></i><b>2.1</b> What is R?</a></li>
<li class="chapter" data-level="2.2" data-path="a-first-r-session.html"><a href="a-first-r-session.html#a-first-r-session-1"><i class="fa fa-check"></i><b>2.2</b> A first R session</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="basics-arithmetic-objects-and-functions.html"><a href="basics-arithmetic-objects-and-functions.html"><i class="fa fa-check"></i><b>3</b> Basics: arithmetic, objects and functions</a><ul>
<li class="chapter" data-level="3.0.1" data-path="basics-arithmetic-objects-and-functions.html"><a href="basics-arithmetic-objects-and-functions.html#arithmetic"><i class="fa fa-check"></i><b>3.0.1</b> Arithmetic</a></li>
<li class="chapter" data-level="3.0.2" data-path="basics-arithmetic-objects-and-functions.html"><a href="basics-arithmetic-objects-and-functions.html#logical-operations"><i class="fa fa-check"></i><b>3.0.2</b> Logical operations</a></li>
<li class="chapter" data-level="3.0.3" data-path="basics-arithmetic-objects-and-functions.html"><a href="basics-arithmetic-objects-and-functions.html#objects"><i class="fa fa-check"></i><b>3.0.3</b> Objects</a></li>
<li class="chapter" data-level="3.1" data-path="basics-arithmetic-objects-and-functions.html"><a href="basics-arithmetic-objects-and-functions.html#kinds-of-data"><i class="fa fa-check"></i><b>3.1</b> Kinds of data</a></li>
<li class="chapter" data-level="3.2" data-path="basics-arithmetic-objects-and-functions.html"><a href="basics-arithmetic-objects-and-functions.html#whats-in-my-workspace"><i class="fa fa-check"></i><b>3.2</b> What’s in my workspace?</a><ul>
<li class="chapter" data-level="3.2.1" data-path="basics-arithmetic-objects-and-functions.html"><a href="basics-arithmetic-objects-and-functions.html#functions"><i class="fa fa-check"></i><b>3.2.1</b> Functions</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="basics-arithmetic-objects-and-functions.html"><a href="basics-arithmetic-objects-and-functions.html#exercises"><i class="fa fa-check"></i><b>3.3</b> Exercises</a><ul>
<li class="chapter" data-level="3.3.1" data-path="basics-arithmetic-objects-and-functions.html"><a href="basics-arithmetic-objects-and-functions.html#calculations"><i class="fa fa-check"></i><b>3.3.1</b> Calculations</a></li>
<li class="chapter" data-level="3.3.2" data-path="basics-arithmetic-objects-and-functions.html"><a href="basics-arithmetic-objects-and-functions.html#objects-1"><i class="fa fa-check"></i><b>3.3.2</b> Objects</a></li>
<li class="chapter" data-level="3.3.3" data-path="basics-arithmetic-objects-and-functions.html"><a href="basics-arithmetic-objects-and-functions.html#functions-1"><i class="fa fa-check"></i><b>3.3.3</b> Functions</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="basics-arithmetic-objects-and-functions.html"><a href="basics-arithmetic-objects-and-functions.html#answers-to-exercises"><i class="fa fa-check"></i><b>3.4</b> Answers to exercises</a><ul>
<li class="chapter" data-level="3.4.1" data-path="basics-arithmetic-objects-and-functions.html"><a href="basics-arithmetic-objects-and-functions.html#calculations-1"><i class="fa fa-check"></i><b>3.4.1</b> Calculations</a></li>
<li class="chapter" data-level="3.4.2" data-path="basics-arithmetic-objects-and-functions.html"><a href="basics-arithmetic-objects-and-functions.html#objects-2"><i class="fa fa-check"></i><b>3.4.2</b> Objects</a></li>
<li class="chapter" data-level="3.4.3" data-path="basics-arithmetic-objects-and-functions.html"><a href="basics-arithmetic-objects-and-functions.html#functions-2"><i class="fa fa-check"></i><b>3.4.3</b> Functions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="data-vectors-matrices-and-data-frames.html"><a href="data-vectors-matrices-and-data-frames.html"><i class="fa fa-check"></i><b>4</b> Data: Vectors, Matrices and Data Frames</a><ul>
<li class="chapter" data-level="4.1" data-path="data-vectors-matrices-and-data-frames.html"><a href="data-vectors-matrices-and-data-frames.html#vectors"><i class="fa fa-check"></i><b>4.1</b> Vectors</a></li>
<li class="chapter" data-level="4.2" data-path="data-vectors-matrices-and-data-frames.html"><a href="data-vectors-matrices-and-data-frames.html#matrices"><i class="fa fa-check"></i><b>4.2</b> Matrices</a></li>
<li class="chapter" data-level="4.3" data-path="data-vectors-matrices-and-data-frames.html"><a href="data-vectors-matrices-and-data-frames.html#factors-and-data-frames"><i class="fa fa-check"></i><b>4.3</b> Factors and Data frames</a></li>
<li class="chapter" data-level="4.4" data-path="data-vectors-matrices-and-data-frames.html"><a href="data-vectors-matrices-and-data-frames.html#exercises-1"><i class="fa fa-check"></i><b>4.4</b> Exercises</a><ul>
<li class="chapter" data-level="4.4.1" data-path="data-vectors-matrices-and-data-frames.html"><a href="data-vectors-matrices-and-data-frames.html#vectors-1"><i class="fa fa-check"></i><b>4.4.1</b> Vectors</a></li>
<li class="chapter" data-level="4.4.2" data-path="data-vectors-matrices-and-data-frames.html"><a href="data-vectors-matrices-and-data-frames.html#matrices-1"><i class="fa fa-check"></i><b>4.4.2</b> Matrices</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="data-vectors-matrices-and-data-frames.html"><a href="data-vectors-matrices-and-data-frames.html#answers-to-exercises-1"><i class="fa fa-check"></i><b>4.5</b> Answers to exercises</a><ul>
<li class="chapter" data-level="4.5.1" data-path="data-vectors-matrices-and-data-frames.html"><a href="data-vectors-matrices-and-data-frames.html#vectors-2"><i class="fa fa-check"></i><b>4.5.1</b> Vectors</a></li>
<li class="chapter" data-level="4.5.2" data-path="data-vectors-matrices-and-data-frames.html"><a href="data-vectors-matrices-and-data-frames.html#matrices-2"><i class="fa fa-check"></i><b>4.5.2</b> Matrices</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="choosing-data-subscripts-and-subsetting.html"><a href="choosing-data-subscripts-and-subsetting.html"><i class="fa fa-check"></i><b>5</b> Choosing data: subscripts and subsetting</a><ul>
<li class="chapter" data-level="5.0.1" data-path="choosing-data-subscripts-and-subsetting.html"><a href="choosing-data-subscripts-and-subsetting.html#subscripts"><i class="fa fa-check"></i><b>5.0.1</b> Subscripts</a></li>
<li class="chapter" data-level="5.0.2" data-path="choosing-data-subscripts-and-subsetting.html"><a href="choosing-data-subscripts-and-subsetting.html#boolean-logic-and-more-complex-subscripting"><i class="fa fa-check"></i><b>5.0.2</b> Boolean logic and more complex subscripting</a></li>
<li class="chapter" data-level="5.0.3" data-path="choosing-data-subscripts-and-subsetting.html"><a href="choosing-data-subscripts-and-subsetting.html#subscripts-in-matrices-and-data-frames"><i class="fa fa-check"></i><b>5.0.3</b> Subscripts in matrices and data frames</a></li>
<li class="chapter" data-level="5.0.4" data-path="choosing-data-subscripts-and-subsetting.html"><a href="choosing-data-subscripts-and-subsetting.html#subset"><i class="fa fa-check"></i><b>5.0.4</b> Subset</a></li>
<li class="chapter" data-level="5.1" data-path="choosing-data-subscripts-and-subsetting.html"><a href="choosing-data-subscripts-and-subsetting.html#exercises-2"><i class="fa fa-check"></i><b>5.1</b> Exercises</a><ul>
<li class="chapter" data-level="5.1.1" data-path="choosing-data-subscripts-and-subsetting.html"><a href="choosing-data-subscripts-and-subsetting.html#subscripts-and-vectors"><i class="fa fa-check"></i><b>5.1.1</b> Subscripts and vectors</a></li>
<li class="chapter" data-level="5.1.2" data-path="choosing-data-subscripts-and-subsetting.html"><a href="choosing-data-subscripts-and-subsetting.html#subscripts-and-matrices"><i class="fa fa-check"></i><b>5.1.2</b> Subscripts and matrices</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="choosing-data-subscripts-and-subsetting.html"><a href="choosing-data-subscripts-and-subsetting.html#answers-to-exercises-2"><i class="fa fa-check"></i><b>5.2</b> Answers to exercises</a><ul>
<li class="chapter" data-level="5.2.1" data-path="choosing-data-subscripts-and-subsetting.html"><a href="choosing-data-subscripts-and-subsetting.html#subscripts-and-vectors-1"><i class="fa fa-check"></i><b>5.2.1</b> Subscripts and vectors</a></li>
<li class="chapter" data-level="5.2.2" data-path="choosing-data-subscripts-and-subsetting.html"><a href="choosing-data-subscripts-and-subsetting.html#subscripts-and-matrices-1"><i class="fa fa-check"></i><b>5.2.2</b> Subscripts and matrices</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="r-scripts-and-your-r-workflow.html"><a href="r-scripts-and-your-r-workflow.html"><i class="fa fa-check"></i><b>6</b> R scripts and your R workflow</a><ul>
<li class="chapter" data-level="6.1" data-path="r-scripts-and-your-r-workflow.html"><a href="r-scripts-and-your-r-workflow.html#writing-and-using-r-scripts"><i class="fa fa-check"></i><b>6.1</b> Writing and using R scripts</a></li>
<li class="chapter" data-level="6.2" data-path="r-scripts-and-your-r-workflow.html"><a href="r-scripts-and-your-r-workflow.html#running-code-from-an-r-script-window"><i class="fa fa-check"></i><b>6.2</b> Running code from an R script window</a></li>
<li class="chapter" data-level="6.3" data-path="r-scripts-and-your-r-workflow.html"><a href="r-scripts-and-your-r-workflow.html#running-code-from-files-using-source"><i class="fa fa-check"></i><b>6.3</b> Running code from files using <code>source()</code></a></li>
<li class="chapter" data-level="6.4" data-path="r-scripts-and-your-r-workflow.html"><a href="r-scripts-and-your-r-workflow.html#workflow-structure-or-what-should-i-put-in-my-script"><i class="fa fa-check"></i><b>6.4</b> Workflow structure, or what should I put in my script?</a></li>
<li class="chapter" data-level="6.5" data-path="r-scripts-and-your-r-workflow.html"><a href="r-scripts-and-your-r-workflow.html#keep-it-neat-making-your-script-easy-to-read"><i class="fa fa-check"></i><b>6.5</b> Keep it neat — making your script easy to read</a></li>
<li class="chapter" data-level="6.6" data-path="r-scripts-and-your-r-workflow.html"><a href="r-scripts-and-your-r-workflow.html#i-wish-i-hadnt-commented-my-code-so-much-said-no-one-ever-4."><i class="fa fa-check"></i><b>6.6</b> “I wish I hadn’t commented my code so much”, said no-one, ever.</a></li>
<li class="chapter" data-level="6.7" data-path="r-scripts-and-your-r-workflow.html"><a href="r-scripts-and-your-r-workflow.html#using-rstudio-to-write-scripts"><i class="fa fa-check"></i><b>6.7</b> Using RStudio to write scripts</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="help-files-and-packages.html"><a href="help-files-and-packages.html"><i class="fa fa-check"></i><b>7</b> Help files and packages</a><ul>
<li class="chapter" data-level="7.1" data-path="help-files-and-packages.html"><a href="help-files-and-packages.html#using-the-help-files"><i class="fa fa-check"></i><b>7.1</b> Using the help files</a></li>
<li class="chapter" data-level="7.2" data-path="help-files-and-packages.html"><a href="help-files-and-packages.html#packages"><i class="fa fa-check"></i><b>7.2</b> Packages</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="importing-data.html"><a href="importing-data.html"><i class="fa fa-check"></i><b>8</b> Importing Data</a><ul>
<li class="chapter" data-level="8.1" data-path="importing-data.html"><a href="importing-data.html#the-rules"><i class="fa fa-check"></i><b>8.1</b> The Rules</a></li>
<li class="chapter" data-level="8.2" data-path="importing-data.html"><a href="importing-data.html#importing-your-text-file"><i class="fa fa-check"></i><b>8.2</b> Importing your Text File</a><ul>
<li class="chapter" data-level="8.2.1" data-path="importing-data.html"><a href="importing-data.html#the-simple-way"><i class="fa fa-check"></i><b>8.2.1</b> The simple way</a></li>
<li class="chapter" data-level="8.2.2" data-path="importing-data.html"><a href="importing-data.html#the-less-simple-way"><i class="fa fa-check"></i><b>8.2.2</b> The less simple way</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="importing-data.html"><a href="importing-data.html#importing-character-data"><i class="fa fa-check"></i><b>8.3</b> Importing character data</a></li>
<li class="chapter" data-level="8.4" data-path="importing-data.html"><a href="importing-data.html#data-on-the-web"><i class="fa fa-check"></i><b>8.4</b> Data on the web</a></li>
<li class="chapter" data-level="8.5" data-path="importing-data.html"><a href="importing-data.html#using-read.table"><i class="fa fa-check"></i><b>8.5</b> Using <code>read.table()</code></a></li>
<li class="chapter" data-level="8.6" data-path="importing-data.html"><a href="importing-data.html#what-to-do-once-youve-managed-to-import-your-data."><i class="fa fa-check"></i><b>8.6</b> What to do once you’ve managed to import your data.</a></li>
<li class="chapter" data-level="8.7" data-path="importing-data.html"><a href="importing-data.html#importing-data-directly-from-excel"><i class="fa fa-check"></i><b>8.7</b> Importing data directly from Excel</a></li>
<li class="chapter" data-level="8.8" data-path="importing-data.html"><a href="importing-data.html#other-data-formats"><i class="fa fa-check"></i><b>8.8</b> Other data formats</a></li>
<li class="chapter" data-level="8.9" data-path="importing-data.html"><a href="importing-data.html#importing-data-into-rstudio"><i class="fa fa-check"></i><b>8.9</b> Importing data into RStudio</a></li>
<li class="chapter" data-level="8.10" data-path="importing-data.html"><a href="importing-data.html#to-attach-or-not-to-attach"><i class="fa fa-check"></i><b>8.10</b> To attach or not to attach?</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="r-graphics-i-drawing-graphs-and-changing-plot-symbols-and-colours-using-the-base-graphics-system.html"><a href="r-graphics-i-drawing-graphs-and-changing-plot-symbols-and-colours-using-the-base-graphics-system.html"><i class="fa fa-check"></i><b>9</b> R graphics I — drawing graphs and changing plot symbols and colours using the base graphics system</a><ul>
<li class="chapter" data-level="9.1" data-path="r-graphics-i-drawing-graphs-and-changing-plot-symbols-and-colours-using-the-base-graphics-system.html"><a href="r-graphics-i-drawing-graphs-and-changing-plot-symbols-and-colours-using-the-base-graphics-system.html#base-graphics-versus-ggplot2-versus-lattice-versus-whaaat"><i class="fa fa-check"></i><b>9.1</b> Base graphics versus ggplot2 versus lattice versus whaaat???</a></li>
<li class="chapter" data-level="9.2" data-path="r-graphics-i-drawing-graphs-and-changing-plot-symbols-and-colours-using-the-base-graphics-system.html"><a href="r-graphics-i-drawing-graphs-and-changing-plot-symbols-and-colours-using-the-base-graphics-system.html#base-graphics-example-ufo-reports-again"><i class="fa fa-check"></i><b>9.2</b> Base graphics example: UFO reports again</a></li>
<li class="chapter" data-level="9.3" data-path="r-graphics-i-drawing-graphs-and-changing-plot-symbols-and-colours-using-the-base-graphics-system.html"><a href="r-graphics-i-drawing-graphs-and-changing-plot-symbols-and-colours-using-the-base-graphics-system.html#scatterplots"><i class="fa fa-check"></i><b>9.3</b> Scatterplots</a></li>
<li class="chapter" data-level="9.4" data-path="r-graphics-i-drawing-graphs-and-changing-plot-symbols-and-colours-using-the-base-graphics-system.html"><a href="r-graphics-i-drawing-graphs-and-changing-plot-symbols-and-colours-using-the-base-graphics-system.html#plot-symbols"><i class="fa fa-check"></i><b>9.4</b> Plot symbols</a></li>
<li class="chapter" data-level="9.5" data-path="r-graphics-i-drawing-graphs-and-changing-plot-symbols-and-colours-using-the-base-graphics-system.html"><a href="r-graphics-i-drawing-graphs-and-changing-plot-symbols-and-colours-using-the-base-graphics-system.html#colours"><i class="fa fa-check"></i><b>9.5</b> Colours</a></li>
<li class="chapter" data-level="9.6" data-path="r-graphics-i-drawing-graphs-and-changing-plot-symbols-and-colours-using-the-base-graphics-system.html"><a href="r-graphics-i-drawing-graphs-and-changing-plot-symbols-and-colours-using-the-base-graphics-system.html#plotting-multiple-symbols-or-colours"><i class="fa fa-check"></i><b>9.6</b> Plotting multiple symbols or colours</a></li>
<li class="chapter" data-level="9.7" data-path="r-graphics-i-drawing-graphs-and-changing-plot-symbols-and-colours-using-the-base-graphics-system.html"><a href="r-graphics-i-drawing-graphs-and-changing-plot-symbols-and-colours-using-the-base-graphics-system.html#colour-palettes-in-r"><i class="fa fa-check"></i><b>9.7</b> Colour palettes in R</a></li>
<li class="chapter" data-level="9.8" data-path="r-graphics-i-drawing-graphs-and-changing-plot-symbols-and-colours-using-the-base-graphics-system.html"><a href="r-graphics-i-drawing-graphs-and-changing-plot-symbols-and-colours-using-the-base-graphics-system.html#using-transparency-in-your-graphs"><i class="fa fa-check"></i><b>9.8</b> Using transparency in your graphs</a></li>
<li class="chapter" data-level="9.9" data-path="r-graphics-i-drawing-graphs-and-changing-plot-symbols-and-colours-using-the-base-graphics-system.html"><a href="r-graphics-i-drawing-graphs-and-changing-plot-symbols-and-colours-using-the-base-graphics-system.html#histograms-and-multiple-plots-in-the-same-window"><i class="fa fa-check"></i><b>9.9</b> Histograms and multiple plots in the same window</a></li>
<li class="chapter" data-level="9.10" data-path="r-graphics-i-drawing-graphs-and-changing-plot-symbols-and-colours-using-the-base-graphics-system.html"><a href="r-graphics-i-drawing-graphs-and-changing-plot-symbols-and-colours-using-the-base-graphics-system.html#boxplots"><i class="fa fa-check"></i><b>9.10</b> Boxplots</a></li>
<li class="chapter" data-level="9.11" data-path="r-graphics-i-drawing-graphs-and-changing-plot-symbols-and-colours-using-the-base-graphics-system.html"><a href="r-graphics-i-drawing-graphs-and-changing-plot-symbols-and-colours-using-the-base-graphics-system.html#bar-charts"><i class="fa fa-check"></i><b>9.11</b> Bar charts</a><ul>
<li class="chapter" data-level="9.11.1" data-path="r-graphics-i-drawing-graphs-and-changing-plot-symbols-and-colours-using-the-base-graphics-system.html"><a href="r-graphics-i-drawing-graphs-and-changing-plot-symbols-and-colours-using-the-base-graphics-system.html#more-complex-barplots"><i class="fa fa-check"></i><b>9.11.1</b> More complex barplots</a></li>
</ul></li>
<li class="chapter" data-level="9.12" data-path="r-graphics-i-drawing-graphs-and-changing-plot-symbols-and-colours-using-the-base-graphics-system.html"><a href="r-graphics-i-drawing-graphs-and-changing-plot-symbols-and-colours-using-the-base-graphics-system.html#other-types-of-plot"><i class="fa fa-check"></i><b>9.12</b> Other types of plot</a><ul>
<li class="chapter" data-level="9.12.1" data-path="r-graphics-i-drawing-graphs-and-changing-plot-symbols-and-colours-using-the-base-graphics-system.html"><a href="r-graphics-i-drawing-graphs-and-changing-plot-symbols-and-colours-using-the-base-graphics-system.html#histogram-with-overlaid-probability-density-estimate"><i class="fa fa-check"></i><b>9.12.1</b> Histogram with overlaid probability density estimate</a></li>
<li class="chapter" data-level="9.12.2" data-path="r-graphics-i-drawing-graphs-and-changing-plot-symbols-and-colours-using-the-base-graphics-system.html"><a href="r-graphics-i-drawing-graphs-and-changing-plot-symbols-and-colours-using-the-base-graphics-system.html#pie-graph"><i class="fa fa-check"></i><b>9.12.2</b> Pie graph</a></li>
<li class="chapter" data-level="9.12.3" data-path="r-graphics-i-drawing-graphs-and-changing-plot-symbols-and-colours-using-the-base-graphics-system.html"><a href="r-graphics-i-drawing-graphs-and-changing-plot-symbols-and-colours-using-the-base-graphics-system.html#d-scatterplot"><i class="fa fa-check"></i><b>9.12.3</b> 3D scatterplot</a></li>
<li class="chapter" data-level="9.12.4" data-path="r-graphics-i-drawing-graphs-and-changing-plot-symbols-and-colours-using-the-base-graphics-system.html"><a href="r-graphics-i-drawing-graphs-and-changing-plot-symbols-and-colours-using-the-base-graphics-system.html#contour-plot"><i class="fa fa-check"></i><b>9.12.4</b> Contour plot</a></li>
</ul></li>
<li class="chapter" data-level="9.13" data-path="r-graphics-i-drawing-graphs-and-changing-plot-symbols-and-colours-using-the-base-graphics-system.html"><a href="r-graphics-i-drawing-graphs-and-changing-plot-symbols-and-colours-using-the-base-graphics-system.html#exporting-graphics"><i class="fa fa-check"></i><b>9.13</b> Exporting Graphics</a><ul>
<li class="chapter" data-level="9.13.1" data-path="r-graphics-i-drawing-graphs-and-changing-plot-symbols-and-colours-using-the-base-graphics-system.html"><a href="r-graphics-i-drawing-graphs-and-changing-plot-symbols-and-colours-using-the-base-graphics-system.html#the-easy-way"><i class="fa fa-check"></i><b>9.13.1</b> The easy way</a></li>
<li class="chapter" data-level="9.13.2" data-path="r-graphics-i-drawing-graphs-and-changing-plot-symbols-and-colours-using-the-base-graphics-system.html"><a href="r-graphics-i-drawing-graphs-and-changing-plot-symbols-and-colours-using-the-base-graphics-system.html#the-hard-way"><i class="fa fa-check"></i><b>9.13.2</b> The hard way</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="r-graphics-ii-adding-elements-to-an-existing-graph.html"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html"><i class="fa fa-check"></i><b>10</b> R graphics II — Adding elements to an existing graph</a><ul>
<li class="chapter" data-level="10.1" data-path="r-graphics-ii-adding-elements-to-an-existing-graph.html"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#simple-regression-lines"><i class="fa fa-check"></i><b>10.1</b> Simple regression lines</a></li>
<li class="chapter" data-level="10.2" data-path="r-graphics-ii-adding-elements-to-an-existing-graph.html"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#multiple-regression-lines"><i class="fa fa-check"></i><b>10.2</b> Multiple regression lines</a></li>
<li class="chapter" data-level="10.3" data-path="r-graphics-ii-adding-elements-to-an-existing-graph.html"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#legends"><i class="fa fa-check"></i><b>10.3</b> Legends</a></li>
<li class="chapter" data-level="10.4" data-path="r-graphics-ii-adding-elements-to-an-existing-graph.html"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#curves"><i class="fa fa-check"></i><b>10.4</b> Curves</a><ul>
<li class="chapter" data-level="10.4.1" data-path="r-graphics-ii-adding-elements-to-an-existing-graph.html"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#adding-a-curve-using-curve"><i class="fa fa-check"></i><b>10.4.1</b> Adding a curve using <code>curve()</code></a></li>
<li class="chapter" data-level="10.4.2" data-path="r-graphics-ii-adding-elements-to-an-existing-graph.html"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#adding-a-curve-using-lines-or-points."><i class="fa fa-check"></i><b>10.4.2</b> Adding a curve using <code>lines()</code> or <code>points()</code>.</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="r-graphics-ii-adding-elements-to-an-existing-graph.html"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#text-and-arrows"><i class="fa fa-check"></i><b>10.5</b> Text and arrows</a></li>
<li class="chapter" data-level="10.6" data-path="r-graphics-ii-adding-elements-to-an-existing-graph.html"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#confidence-bands-for-fitted-lines"><i class="fa fa-check"></i><b>10.6</b> Confidence bands for fitted lines</a><ul>
<li class="chapter" data-level="10.6.1" data-path="r-graphics-ii-adding-elements-to-an-existing-graph.html"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#adding-confidence-bands-using-lines"><i class="fa fa-check"></i><b>10.6.1</b> Adding confidence bands using <code>lines()</code></a></li>
<li class="chapter" data-level="10.6.2" data-path="r-graphics-ii-adding-elements-to-an-existing-graph.html"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#adding-confidence-intervals-to-fitted-lines-using-polygon"><i class="fa fa-check"></i><b>10.6.2</b> Adding confidence intervals to fitted lines using <code>polygon()</code></a></li>
</ul></li>
<li class="chapter" data-level="10.7" data-path="r-graphics-ii-adding-elements-to-an-existing-graph.html"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#error-bars"><i class="fa fa-check"></i><b>10.7</b> Error bars</a><ul>
<li class="chapter" data-level="10.7.1" data-path="r-graphics-ii-adding-elements-to-an-existing-graph.html"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#adding-error-bars-using-arrows"><i class="fa fa-check"></i><b>10.7.1</b> Adding error bars using <code>arrows()</code></a></li>
<li class="chapter" data-level="10.7.2" data-path="r-graphics-ii-adding-elements-to-an-existing-graph.html"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#plotting-means-and-error-bars-using-plotmeans"><i class="fa fa-check"></i><b>10.7.2</b> Plotting means and error bars using <code>plotmeans()</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="graphics-with-ggplot2.html"><a href="graphics-with-ggplot2.html"><i class="fa fa-check"></i><b>11</b> Graphics with ggplot2</a><ul>
<li class="chapter" data-level="11.1" data-path="graphics-with-ggplot2.html"><a href="graphics-with-ggplot2.html#ggplot2-introduced"><i class="fa fa-check"></i><b>11.1</b> ggplot2 introduced</a></li>
<li class="chapter" data-level="11.2" data-path="graphics-with-ggplot2.html"><a href="graphics-with-ggplot2.html#scaling-axes-and-varying-colour-or-shapes-by-factor-levels"><i class="fa fa-check"></i><b>11.2</b> Scaling axes and varying colour or shapes by factor levels</a></li>
<li class="chapter" data-level="11.3" data-path="graphics-with-ggplot2.html"><a href="graphics-with-ggplot2.html#facets"><i class="fa fa-check"></i><b>11.3</b> Facets</a></li>
<li class="chapter" data-level="11.4" data-path="graphics-with-ggplot2.html"><a href="graphics-with-ggplot2.html#histograms"><i class="fa fa-check"></i><b>11.4</b> Histograms</a></li>
<li class="chapter" data-level="11.5" data-path="graphics-with-ggplot2.html"><a href="graphics-with-ggplot2.html#boxplots-1"><i class="fa fa-check"></i><b>11.5</b> Boxplots</a></li>
<li class="chapter" data-level="11.6" data-path="graphics-with-ggplot2.html"><a href="graphics-with-ggplot2.html#final-word"><i class="fa fa-check"></i><b>11.6</b> Final word</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="basic-statistical-concepts.html"><a href="basic-statistical-concepts.html"><i class="fa fa-check"></i><b>12</b> Basic Statistical Concepts</a><ul>
<li class="chapter" data-level="12.1" data-path="basic-statistical-concepts.html"><a href="basic-statistical-concepts.html#populations-and-samples"><i class="fa fa-check"></i><b>12.1</b> Populations and Samples</a></li>
<li class="chapter" data-level="12.2" data-path="basic-statistical-concepts.html"><a href="basic-statistical-concepts.html#descriptive-and-exploratory-statistics"><i class="fa fa-check"></i><b>12.2</b> Descriptive and exploratory statistics</a><ul>
<li class="chapter" data-level="12.2.1" data-path="basic-statistical-concepts.html"><a href="basic-statistical-concepts.html#maximum-and-minimum"><i class="fa fa-check"></i><b>12.2.1</b> Maximum and minimum</a></li>
<li class="chapter" data-level="12.2.2" data-path="basic-statistical-concepts.html"><a href="basic-statistical-concepts.html#frequency-distribution"><i class="fa fa-check"></i><b>12.2.2</b> Frequency distribution</a></li>
<li class="chapter" data-level="12.2.3" data-path="basic-statistical-concepts.html"><a href="basic-statistical-concepts.html#kinds-of-frequency-distribution"><i class="fa fa-check"></i><b>12.2.3</b> Kinds of frequency distribution</a></li>
<li class="chapter" data-level="12.2.4" data-path="basic-statistical-concepts.html"><a href="basic-statistical-concepts.html#measures-of-central-tendency"><i class="fa fa-check"></i><b>12.2.4</b> Measures of central tendency</a></li>
<li class="chapter" data-level="12.2.5" data-path="basic-statistical-concepts.html"><a href="basic-statistical-concepts.html#measures-of-dispersion"><i class="fa fa-check"></i><b>12.2.5</b> Measures of dispersion</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="basic-statistical-concepts.html"><a href="basic-statistical-concepts.html#standard-errors-and-confidence-intervals"><i class="fa fa-check"></i><b>12.3</b> Standard errors and confidence intervals</a><ul>
<li class="chapter" data-level="12.3.1" data-path="basic-statistical-concepts.html"><a href="basic-statistical-concepts.html#code-used-to-draw-figure-6"><i class="fa fa-check"></i><b>12.3.1</b> Code used to draw figure 6</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="what-is-statistical-testing.html"><a href="what-is-statistical-testing.html"><i class="fa fa-check"></i><b>13</b> What is statistical testing?</a><ul>
<li class="chapter" data-level="13.1" data-path="what-is-statistical-testing.html"><a href="what-is-statistical-testing.html#the-problem"><i class="fa fa-check"></i><b>13.1</b> The problem</a></li>
<li class="chapter" data-level="13.2" data-path="what-is-statistical-testing.html"><a href="what-is-statistical-testing.html#statistical-testing-in-a-nutshell"><i class="fa fa-check"></i><b>13.2</b> Statistical testing in a nutshell</a><ul>
<li class="chapter" data-level="13.2.1" data-path="what-is-statistical-testing.html"><a href="what-is-statistical-testing.html#decide-on-the-null-and-alternative-hypotheses."><i class="fa fa-check"></i><b>13.2.1</b> Decide on the null and alternative hypotheses.</a></li>
<li class="chapter" data-level="13.2.2" data-path="what-is-statistical-testing.html"><a href="what-is-statistical-testing.html#calculate-the-size-of-the-effect."><i class="fa fa-check"></i><b>13.2.2</b> Calculate the size of the effect.</a></li>
<li class="chapter" data-level="13.2.3" data-path="what-is-statistical-testing.html"><a href="what-is-statistical-testing.html#transform-the-effect-size-so-that-we-can-compare-it-to-an-expected-distribution."><i class="fa fa-check"></i><b>13.2.3</b> Transform the effect size so that we can compare it to an expected distribution.</a></li>
<li class="chapter" data-level="13.2.4" data-path="what-is-statistical-testing.html"><a href="what-is-statistical-testing.html#ask-what-the-probability-is-of-observing-an-effect-as-big-or-bigger-than-the-one-we-have-seen-assuming-the-null-hypothesis-to-be-true."><i class="fa fa-check"></i><b>13.2.4</b> Ask what the probability is of observing an effect as big, or bigger than the one we have seen, assuming the null hypothesis to be true.</a></li>
<li class="chapter" data-level="13.2.5" data-path="what-is-statistical-testing.html"><a href="what-is-statistical-testing.html#think-about-what-the-result-means."><i class="fa fa-check"></i><b>13.2.5</b> Think about what the result means.</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="what-is-statistical-testing.html"><a href="what-is-statistical-testing.html#how-a-statistical-test-works"><i class="fa fa-check"></i><b>13.3</b> How a statistical test works</a><ul>
<li class="chapter" data-level="13.3.1" data-path="what-is-statistical-testing.html"><a href="what-is-statistical-testing.html#step-1-generating-our-null-and-alternative-hypotheses."><i class="fa fa-check"></i><b>13.3.1</b> Step 1 generating our null and alternative hypotheses.</a></li>
<li class="chapter" data-level="13.3.2" data-path="what-is-statistical-testing.html"><a href="what-is-statistical-testing.html#step-2-calculating-the-size-of-the-effect"><i class="fa fa-check"></i><b>13.3.2</b> Step 2 calculating the size of the effect</a></li>
<li class="chapter" data-level="13.3.3" data-path="what-is-statistical-testing.html"><a href="what-is-statistical-testing.html#step-3-transforming-the-effect-size-so-that-we-can-compare-it-to-an-expected-distribution."><i class="fa fa-check"></i><b>13.3.3</b> Step 3 Transforming the effect size so that we can compare it to an expected distribution.</a></li>
<li class="chapter" data-level="13.3.4" data-path="what-is-statistical-testing.html"><a href="what-is-statistical-testing.html#step-4-what-is-the-probability-is-of-observing-an-effect-as-big-or-bigger-than-the-one-we-have-seen-assuming-the-null-hypothesis-to-be-true"><i class="fa fa-check"></i><b>13.3.4</b> Step 4 What is the probability is of observing an effect as big, or bigger than the one we have seen, assuming the null hypothesis to be true?</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="what-is-statistical-testing.html"><a href="what-is-statistical-testing.html#what-statistical-testing-does-and-doesnt-tell-us"><i class="fa fa-check"></i><b>13.4</b> What statistical testing does and doesn’t tell us</a></li>
<li class="chapter" data-level="13.5" data-path="what-is-statistical-testing.html"><a href="what-is-statistical-testing.html#code-used-to-draw-figure-5"><i class="fa fa-check"></i><b>13.5</b> Code used to draw figure 5</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="the-chi-squared-test-and-a-classic-dataset-on-smoking-and-cancer.html"><a href="the-chi-squared-test-and-a-classic-dataset-on-smoking-and-cancer.html"><i class="fa fa-check"></i><b>14</b> The Chi-squared Test and a Classic Dataset on Smoking and Cancer</a><ul>
<li class="chapter" data-level="14.1" data-path="the-chi-squared-test-and-a-classic-dataset-on-smoking-and-cancer.html"><a href="the-chi-squared-test-and-a-classic-dataset-on-smoking-and-cancer.html#are-lung-cancer-patients-who-smoke-more-likely-to-be-heavy-smokers"><i class="fa fa-check"></i><b>14.1</b> Are lung cancer patients who smoke more likely to be heavy smokers?</a></li>
<li class="chapter" data-level="14.2" data-path="the-chi-squared-test-and-a-classic-dataset-on-smoking-and-cancer.html"><a href="the-chi-squared-test-and-a-classic-dataset-on-smoking-and-cancer.html#the-chi-squared-test"><i class="fa fa-check"></i><b>14.2</b> The Chi-squared test</a></li>
<li class="chapter" data-level="14.3" data-path="the-chi-squared-test-and-a-classic-dataset-on-smoking-and-cancer.html"><a href="the-chi-squared-test-and-a-classic-dataset-on-smoking-and-cancer.html#chi-squared-test-with-contingency-tables"><i class="fa fa-check"></i><b>14.3</b> Chi-squared test with contingency tables</a></li>
<li class="chapter" data-level="14.4" data-path="the-chi-squared-test-and-a-classic-dataset-on-smoking-and-cancer.html"><a href="the-chi-squared-test-and-a-classic-dataset-on-smoking-and-cancer.html#assumptions-and-limitations-of-the-chi-squared-test"><i class="fa fa-check"></i><b>14.4</b> Assumptions and limitations of the chi-squared test</a></li>
<li class="chapter" data-level="14.5" data-path="the-chi-squared-test-and-a-classic-dataset-on-smoking-and-cancer.html"><a href="the-chi-squared-test-and-a-classic-dataset-on-smoking-and-cancer.html#are-lung-cancer-patients-more-likely-to-be-smokers-than-controls"><i class="fa fa-check"></i><b>14.5</b> Are lung cancer patients more likely to be smokers than controls?</a></li>
<li class="chapter" data-level="14.6" data-path="the-chi-squared-test-and-a-classic-dataset-on-smoking-and-cancer.html"><a href="the-chi-squared-test-and-a-classic-dataset-on-smoking-and-cancer.html#fishers-exact-test"><i class="fa fa-check"></i><b>14.6</b> Fisher’s exact test</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="comparing-immune-responses-between-two-caterpillar-species-using-a-t-test.html"><a href="comparing-immune-responses-between-two-caterpillar-species-using-a-t-test.html"><i class="fa fa-check"></i><b>15</b> Comparing immune responses between two caterpillar species using a t-test</a><ul>
<li class="chapter" data-level="15.1" data-path="comparing-immune-responses-between-two-caterpillar-species-using-a-t-test.html"><a href="comparing-immune-responses-between-two-caterpillar-species-using-a-t-test.html#assumptions-and-limitations-of-standard-parametric-statistics"><i class="fa fa-check"></i><b>15.1</b> Assumptions and limitations of standard parametric statistics</a><ul>
<li class="chapter" data-level="15.1.1" data-path="comparing-immune-responses-between-two-caterpillar-species-using-a-t-test.html"><a href="comparing-immune-responses-between-two-caterpillar-species-using-a-t-test.html#normal-errors."><i class="fa fa-check"></i><b>15.1.1</b> Normal errors.</a></li>
<li class="chapter" data-level="15.1.2" data-path="comparing-immune-responses-between-two-caterpillar-species-using-a-t-test.html"><a href="comparing-immune-responses-between-two-caterpillar-species-using-a-t-test.html#independence-of-data-points."><i class="fa fa-check"></i><b>15.1.2</b> Independence of data points.</a></li>
<li class="chapter" data-level="15.1.3" data-path="comparing-immune-responses-between-two-caterpillar-species-using-a-t-test.html"><a href="comparing-immune-responses-between-two-caterpillar-species-using-a-t-test.html#equal-variances."><i class="fa fa-check"></i><b>15.1.3</b> Equal variances.</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="comparing-immune-responses-between-two-caterpillar-species-using-a-t-test.html"><a href="comparing-immune-responses-between-two-caterpillar-species-using-a-t-test.html#importing-the-data"><i class="fa fa-check"></i><b>15.2</b> Importing the Data</a></li>
<li class="chapter" data-level="15.3" data-path="comparing-immune-responses-between-two-caterpillar-species-using-a-t-test.html"><a href="comparing-immune-responses-between-two-caterpillar-species-using-a-t-test.html#descriptives-and-initial-exploration"><i class="fa fa-check"></i><b>15.3</b> Descriptives and Initial Exploration</a></li>
<li class="chapter" data-level="15.4" data-path="comparing-immune-responses-between-two-caterpillar-species-using-a-t-test.html"><a href="comparing-immune-responses-between-two-caterpillar-species-using-a-t-test.html#comparing-two-means-with-a-t-test"><i class="fa fa-check"></i><b>15.4</b> Comparing Two Means With a t-test</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="correlation-analysis.html"><a href="correlation-analysis.html"><i class="fa fa-check"></i><b>16</b> Correlation analysis</a><ul>
<li class="chapter" data-level="16.1" data-path="correlation-analysis.html"><a href="correlation-analysis.html#calculating-the-correlation-coefficient"><i class="fa fa-check"></i><b>16.1</b> Calculating the correlation coefficient</a><ul>
<li class="chapter" data-level="16.1.1" data-path="correlation-analysis.html"><a href="correlation-analysis.html#interpreting-our-correlation-coefficient."><i class="fa fa-check"></i><b>16.1.1</b> Interpreting our correlation coefficient.</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="correlation-analysis.html"><a href="correlation-analysis.html#statistical-significance-of-r"><i class="fa fa-check"></i><b>16.2</b> Statistical significance of <em>r</em></a></li>
<li class="chapter" data-level="16.3" data-path="correlation-analysis.html"><a href="correlation-analysis.html#assumptions-of-correlation-analysis"><i class="fa fa-check"></i><b>16.3</b> Assumptions of correlation analysis</a><ul>
<li class="chapter" data-level="16.3.1" data-path="correlation-analysis.html"><a href="correlation-analysis.html#comparing-correlations-between-swim-run-and-bike-splits"><i class="fa fa-check"></i><b>16.3.1</b> Comparing correlations between swim, run and bike splits</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="correlation-analysis.html"><a href="correlation-analysis.html#correlation-causality-sample-size-and-significance."><i class="fa fa-check"></i><b>16.4</b> Correlation, causality, sample size and significance.</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="using-linear-regression-to-analyse-tb-trends-in-the-uk.html"><a href="using-linear-regression-to-analyse-tb-trends-in-the-uk.html"><i class="fa fa-check"></i><b>17</b> Using Linear Regression to Analyse TB trends in the UK</a><ul>
<li class="chapter" data-level="17.0.1" data-path="using-linear-regression-to-analyse-tb-trends-in-the-uk.html"><a href="using-linear-regression-to-analyse-tb-trends-in-the-uk.html#least-squares-line-fitting"><i class="fa fa-check"></i><b>17.0.1</b> Least squares line fitting</a></li>
<li class="chapter" data-level="17.0.2" data-path="using-linear-regression-to-analyse-tb-trends-in-the-uk.html"><a href="using-linear-regression-to-analyse-tb-trends-in-the-uk.html#significance-tests-for-linear-regression"><i class="fa fa-check"></i><b>17.0.2</b> Significance tests for linear regression</a></li>
<li class="chapter" data-level="17.1" data-path="using-linear-regression-to-analyse-tb-trends-in-the-uk.html"><a href="using-linear-regression-to-analyse-tb-trends-in-the-uk.html#bovine-tb"><i class="fa fa-check"></i><b>17.1</b> Bovine TB</a></li>
<li class="chapter" data-level="17.2" data-path="using-linear-regression-to-analyse-tb-trends-in-the-uk.html"><a href="using-linear-regression-to-analyse-tb-trends-in-the-uk.html#assumptions-of-linear-regression"><i class="fa fa-check"></i><b>17.2</b> Assumptions of linear regression</a><ul>
<li class="chapter" data-level="17.2.1" data-path="using-linear-regression-to-analyse-tb-trends-in-the-uk.html"><a href="using-linear-regression-to-analyse-tb-trends-in-the-uk.html#diagnostic-plots"><i class="fa fa-check"></i><b>17.2.1</b> Diagnostic plots</a></li>
<li class="chapter" data-level="17.2.2" data-path="using-linear-regression-to-analyse-tb-trends-in-the-uk.html"><a href="using-linear-regression-to-analyse-tb-trends-in-the-uk.html#diagnostic-plots-for-our-m.bovis-regression"><i class="fa fa-check"></i><b>17.2.2</b> Diagnostic plots for our <em>M.bovis</em> regression</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="using-linear-regression-to-analyse-tb-trends-in-the-uk.html"><a href="using-linear-regression-to-analyse-tb-trends-in-the-uk.html#interpreting-our-regression-and-predicting-future-cases"><i class="fa fa-check"></i><b>17.3</b> Interpreting our regression and predicting future cases</a></li>
<li class="chapter" data-level="17.4" data-path="using-linear-regression-to-analyse-tb-trends-in-the-uk.html"><a href="using-linear-regression-to-analyse-tb-trends-in-the-uk.html#multi-drug-resistant-tb"><i class="fa fa-check"></i><b>17.4</b> Multi-drug resistant TB</a></li>
<li class="chapter" data-level="17.5" data-path="using-linear-regression-to-analyse-tb-trends-in-the-uk.html"><a href="using-linear-regression-to-analyse-tb-trends-in-the-uk.html#fitting-a-quadratic-model"><i class="fa fa-check"></i><b>17.5</b> Fitting a quadratic model</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="anova-and-football.html"><a href="anova-and-football.html"><i class="fa fa-check"></i><b>18</b> ANOVA and Football</a><ul>
<li class="chapter" data-level="18.1" data-path="anova-and-football.html"><a href="anova-and-football.html#analysis-of-variance"><i class="fa fa-check"></i><b>18.1</b> Analysis of Variance</a></li>
<li class="chapter" data-level="18.2" data-path="anova-and-football.html"><a href="anova-and-football.html#interpreting-anova-results"><i class="fa fa-check"></i><b>18.2</b> Interpreting ANOVA results</a></li>
<li class="chapter" data-level="18.3" data-path="anova-and-football.html"><a href="anova-and-football.html#what-makes-a-professional-footballer"><i class="fa fa-check"></i><b>18.3</b> What makes a professional footballer?</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="yeast-sex-and-two-factor-anova-.html"><a href="yeast-sex-and-two-factor-anova-.html"><i class="fa fa-check"></i><b>19</b> Yeast sex and two factor ANOVA.</a><ul>
<li class="chapter" data-level="19.1" data-path="yeast-sex-and-two-factor-anova-.html"><a href="yeast-sex-and-two-factor-anova-.html#yeast-sexual-selection"><i class="fa fa-check"></i><b>19.1</b> Yeast sexual selection</a></li>
<li class="chapter" data-level="19.2" data-path="yeast-sex-and-two-factor-anova-.html"><a href="yeast-sex-and-two-factor-anova-.html#understanding-the-coefficients-table"><i class="fa fa-check"></i><b>19.2</b> Understanding the coefficients table</a></li>
<li class="chapter" data-level="19.3" data-path="yeast-sex-and-two-factor-anova-.html"><a href="yeast-sex-and-two-factor-anova-.html#which-statistical-tests-to-use-with-lm"><i class="fa fa-check"></i><b>19.3</b> Which statistical tests to use with <code>lm()</code>?</a></li>
<li class="chapter" data-level="19.4" data-path="yeast-sex-and-two-factor-anova-.html"><a href="yeast-sex-and-two-factor-anova-.html#diagnostics"><i class="fa fa-check"></i><b>19.4</b> Diagnostics</a></li>
<li class="chapter" data-level="19.5" data-path="yeast-sex-and-two-factor-anova-.html"><a href="yeast-sex-and-two-factor-anova-.html#visualising-the-data"><i class="fa fa-check"></i><b>19.5</b> Visualising the data</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introductory R: A beginner’s guide to programming, data visualisation and statistical analysis in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="r-graphics-ii-adding-elements-to-an-existing-graph" class="section level1">
<h1><span class="header-section-number">Chapter 10</span> R graphics II — Adding elements to an existing graph</h1>
<p>All the examples we’ve looked at in detail so far use arguments within the <code>plot()</code> function call to change the appearance of our graph, but we’ve also seen an example of using the <code>legend()</code> function to add something extra to an existing graph. R has quite a few functions which, like <code>legend()</code> can draw new elements onto existing graphs. These include:</p>
<table>
<thead>
<tr class="header">
<th align="left">Function</th>
<th align="left">Purpose</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>points()</code></td>
<td align="left">Draws points onto a plot</td>
</tr>
<tr class="even">
<td align="left"><code>lines()</code></td>
<td align="left">Draws lines</td>
</tr>
<tr class="odd">
<td align="left"><code>abline()</code></td>
<td align="left">Draws a line specified by intercept and slope</td>
</tr>
<tr class="even">
<td align="left"><code>polygon()</code></td>
<td align="left">Draws a shape</td>
</tr>
<tr class="odd">
<td align="left"><code>arrows()</code></td>
<td align="left">Draws arrows on a plot</td>
</tr>
<tr class="even">
<td align="left"><code>text()</code></td>
<td align="left">Adds text</td>
</tr>
<tr class="odd">
<td align="left"><code>mtext()</code></td>
<td align="left">Adds text in the plot margins</td>
</tr>
<tr class="even">
<td align="left"><code>legend()</code></td>
<td align="left">Adds a legend</td>
</tr>
<tr class="odd">
<td align="left"><code>axis()</code></td>
<td align="left">Adds an axis</td>
</tr>
<tr class="even">
<td align="left"><code>title()</code></td>
<td align="left">Adds a title or subtitle</td>
</tr>
</tbody>
</table>
<p>These functions will all add elements to the plot which is currently displayed in the graphics window, so you have to be a little careful about where you put the code. The best option is to use a script and have these functions directly after the <code>plot()</code> function call. Let’s look at some examples.</p>
<div id="simple-regression-lines" class="section level2">
<h2><span class="header-section-number">10.1</span> Simple regression lines</h2>
<p>Let’s go back to our data on pinnipeds. If we plot the log of male brain size against the log of male mass then we see a positive relationship (big animals have bigger brains) that could be described reasonably well by a straight line:</p>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb287-1"></a></span>
<span id="cb287-2"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb287-2"></a>pinniped &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;http://www.introductoryr.co.uk/Pinniped_brains.csv&quot;</span>, </span>
<span id="cb287-3"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb287-3"></a>                     <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</span>
<span id="cb287-4"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb287-4"></a></span>
<span id="cb287-5"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb287-5"></a><span class="kw">plot</span>(<span class="kw">log</span>(pinniped<span class="op">$</span>Male_brain) <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(pinniped<span class="op">$</span>Male_mass),</span>
<span id="cb287-6"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb287-6"></a>     <span class="dt">xlab =</span> <span class="st">&quot;Log male mass (Kg)&quot;</span>,</span>
<span id="cb287-7"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb287-7"></a>     <span class="dt">ylab =</span> <span class="st">&quot;Log male brain mass (g)&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-279"></span>
<img src="3rd_Edition_files/figure-html/unnamed-chunk-279-1.png" alt="Log of brain size plotted against the log of body mass for male pinnipeds from 33 species" width="672" />
<p class="caption">
Figure 10.1: Log of brain size plotted against the log of body mass for male pinnipeds from 33 species
</p>
</div>
<p>We can generate the slope and intercept of a fitted linear regression line using the <code>lm()</code> function. If you don’t know what this is don’t worry, the analysis is explained in chapter XX: for the moment all you need to know is that it’s a way of generating a best-fit line.</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb288-1"></a><span class="kw">lm</span>(<span class="kw">log</span>(pinniped<span class="op">$</span>Male_brain) <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(pinniped<span class="op">$</span>Male_mass))</span>
<span id="cb288-2"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb288-2"></a></span>
<span id="cb288-3"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb288-3"></a>Call<span class="op">:</span></span>
<span id="cb288-4"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb288-4"></a><span class="kw">lm</span>(<span class="dt">formula =</span> <span class="kw">log</span>(pinniped<span class="op">$</span>Male_brain) <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(pinniped<span class="op">$</span>Male_mass))</span>
<span id="cb288-5"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb288-5"></a></span>
<span id="cb288-6"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb288-6"></a>Coefficients<span class="op">:</span></span>
<span id="cb288-7"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb288-7"></a><span class="st">            </span>(Intercept)  <span class="kw">log</span>(pinniped<span class="op">$</span>Male_mass)  </span>
<span id="cb288-8"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb288-8"></a>                  <span class="fl">3.672</span>                    <span class="fl">0.435</span>  </span></code></pre></div>
<p>So our intercept is 3.672 and our slope is 0.435. If we want to add this line to our plot we can use the <code>abline()</code> function which takes an intercept (“a”) and a slope (“b”) and draws a line:</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb289-1"></a></span>
<span id="cb289-2"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb289-2"></a><span class="kw">plot</span>(<span class="kw">log</span>(pinniped<span class="op">$</span>Male_brain) <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(pinniped<span class="op">$</span>Male_mass),</span>
<span id="cb289-3"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb289-3"></a>     <span class="dt">xlab =</span> <span class="st">&quot;Log male mass (Kg)&quot;</span>,</span>
<span id="cb289-4"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb289-4"></a>     <span class="dt">ylab =</span> <span class="st">&quot;Log male brain mass (g)&quot;</span>)</span>
<span id="cb289-5"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb289-5"></a></span>
<span id="cb289-6"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb289-6"></a><span class="kw">abline</span>(<span class="dt">a =</span> <span class="fl">3.672</span>, <span class="dt">b =</span> <span class="fl">0.435</span>,</span>
<span id="cb289-7"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb289-7"></a>       <span class="dt">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb289-8"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb289-8"></a>       <span class="dt">col =</span> <span class="st">&quot;darkblue&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-281"></span>
<img src="3rd_Edition_files/figure-html/unnamed-chunk-281-1.png" alt="Log of brain size plotted against the log of body mass for male pinnipeds from 33 species. Line is a fitted linear regression." width="672" />
<p class="caption">
Figure 10.2: Log of brain size plotted against the log of body mass for male pinnipeds from 33 species. Line is a fitted linear regression.
</p>
</div>
<p>Looking at that <code>abline()</code> call in a bit more detail you can see firstly that I’ve specified the slope and intercept with the <code>a =</code> and <code>b =</code> arguments. I’ve then asked for the line width to be twice the default width (<code>lwd = 2</code>) and finally I’ve used the <code>col = "darkblue"</code> argument to set the colour of the line.</p>
<p><code>abline()</code> will actually take the coefficients directly from <code>lm()</code> if you are fitting a simple linear regression, either if you save the output from <code>lm()</code> and then give that to <code>abline()</code> as an argument or if you just put the whole <code>lm()</code> call within the <code>abline()</code> function call. So either of the following would have produced an identical line to the one we generated above:</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb290-1"></a><span class="co"># Save linear regression output as object &quot;X1&quot;</span></span>
<span id="cb290-2"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb290-2"></a>X1 &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">log</span>(pinniped<span class="op">$</span>Male_brain) <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(pinniped<span class="op">$</span>Male_mass))</span>
<span id="cb290-3"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb290-3"></a></span>
<span id="cb290-4"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb290-4"></a><span class="co"># Use object X1 in abline()</span></span>
<span id="cb290-5"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb290-5"></a><span class="kw">abline</span>(X1,</span>
<span id="cb290-6"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb290-6"></a>      <span class="dt">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb290-7"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb290-7"></a>      <span class="dt">col =</span> <span class="st">&quot;darkblue&quot;</span>)</span>
<span id="cb290-8"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb290-8"></a></span>
<span id="cb290-9"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb290-9"></a></span>
<span id="cb290-10"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb290-10"></a><span class="co"># Calculate linear regression directly within abline() function call</span></span>
<span id="cb290-11"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb290-11"></a><span class="kw">abline</span>(<span class="kw">lm</span>(<span class="kw">log</span>(pinniped<span class="op">$</span>Male_brain) <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(pinniped<span class="op">$</span>Male_mass)),</span>
<span id="cb290-12"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb290-12"></a>      <span class="dt">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb290-13"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb290-13"></a>      <span class="dt">col =</span> <span class="st">&quot;darkblue&quot;</span>)</span></code></pre></div>
<p><code>abline()</code> will also add vertical or horizontal lines to a plot: if you use the <code>h =</code> argument then it will draw a horizontal line at the point on the y-axis specified, and <code>v =</code> will draw a vertical line at the point specified on the x axis. You can also use a vector of numbers if you want multiple horizontal or vertical lines.</p>
<p>The <code>lty =</code> parameter specifies the type of line drawn. Here are the various options:</p>
<details>
<p><summary>Click here to see the code</summary></p>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb291-1"></a><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb291-2"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb291-2"></a><span class="kw">plot</span>(</span>
<span id="cb291-3"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb291-3"></a>  <span class="dv">1</span><span class="op">:</span><span class="dv">8</span>,</span>
<span id="cb291-4"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb291-4"></a>  <span class="dv">1</span><span class="op">:</span><span class="dv">8</span>,</span>
<span id="cb291-5"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb291-5"></a>  <span class="dt">type =</span> <span class="st">&quot;n&quot;</span>,</span>
<span id="cb291-6"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb291-6"></a>  <span class="dt">bty =</span> <span class="st">&quot;n&quot;</span>,</span>
<span id="cb291-7"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb291-7"></a>  <span class="dt">xaxt =</span> <span class="st">&quot;n&quot;</span>,</span>
<span id="cb291-8"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb291-8"></a>  <span class="dt">yaxt =</span> <span class="st">&quot;n&quot;</span>,</span>
<span id="cb291-9"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb291-9"></a>  <span class="dt">xlab =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb291-10"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb291-10"></a>  <span class="dt">ylab =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb291-11"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb291-11"></a>)</span>
<span id="cb291-12"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb291-12"></a><span class="kw">abline</span>(<span class="dt">h =</span> <span class="dv">2</span><span class="op">:</span><span class="dv">7</span>, <span class="dt">lty =</span> <span class="dv">6</span><span class="op">:</span><span class="dv">1</span>)</span>
<span id="cb291-13"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb291-13"></a><span class="kw">axis</span>(</span>
<span id="cb291-14"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb291-14"></a>  <span class="dt">side =</span> <span class="dv">2</span>,</span>
<span id="cb291-15"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb291-15"></a>  <span class="dt">at =</span> <span class="dv">7</span><span class="op">:</span><span class="dv">2</span>,</span>
<span id="cb291-16"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb291-16"></a>  <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;lty = 1&quot;</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="st">&quot;lty = 6&quot;</span>),</span>
<span id="cb291-17"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb291-17"></a>  <span class="dt">tick =</span> <span class="ot">FALSE</span>,</span>
<span id="cb291-18"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb291-18"></a>  <span class="dt">lwd =</span> <span class="dv">0</span>,</span>
<span id="cb291-19"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb291-19"></a>  <span class="dt">las =</span> <span class="dv">1</span></span>
<span id="cb291-20"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb291-20"></a>)</span>
<span id="cb291-21"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb291-21"></a><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">2</span>) <span class="op">+</span><span class="st"> </span><span class="fl">0.1</span>)</span></code></pre></div>
</details>
<div class="figure"><span id="fig:unnamed-chunk-284"></span>
<img src="3rd_Edition_files/figure-html/unnamed-chunk-284-1.png" alt="The different line types available in base R graphics" width="384" />
<p class="caption">
Figure 10.3: The different line types available in base R graphics
</p>
</div>
</div>
<div id="multiple-regression-lines" class="section level2">
<h2><span class="header-section-number">10.2</span> Multiple regression lines</h2>
<p>You might recall from the last chapter that we divided our pinniped species by mating system into harem breeders, where males defend groups of females in the mating season, and non-harem breeders, where males only associate with a single female. We plotted our data with colours defined by a new factor that we generated called <code>Mating_system</code> and it looked as though the relationship between log brain size and log body mass in males varied somewhat between the two groups. Let’s look at that plot again.</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb292-1"></a></span>
<span id="cb292-2"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb292-2"></a>Mating_system &lt;-</span>
<span id="cb292-3"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb292-3"></a><span class="st">  </span><span class="kw">factor</span>(<span class="kw">ifelse</span>(pinniped<span class="op">$</span>Harem <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="st">&quot;Non harem&quot;</span>, <span class="st">&quot;Harem&quot;</span>))</span>
<span id="cb292-4"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb292-4"></a></span>
<span id="cb292-5"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb292-5"></a>colours &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;aquamarine4&quot;</span>, <span class="st">&quot;chocolate2&quot;</span>)</span>
<span id="cb292-6"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb292-6"></a></span>
<span id="cb292-7"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb292-7"></a><span class="kw">plot</span>(</span>
<span id="cb292-8"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb292-8"></a>  <span class="kw">log</span>(pinniped<span class="op">$</span>Male_brain) <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(pinniped<span class="op">$</span>Male_mass),</span>
<span id="cb292-9"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb292-9"></a>  <span class="dt">xlab =</span> <span class="st">&quot;Log body mass (Kg)&quot;</span>,</span>
<span id="cb292-10"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb292-10"></a>  <span class="dt">ylab =</span> <span class="st">&quot;Log brain mass (g)&quot;</span>,</span>
<span id="cb292-11"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb292-11"></a>  <span class="dt">pch =</span> <span class="dv">16</span>,</span>
<span id="cb292-12"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb292-12"></a>  <span class="dt">col =</span> colours[Mating_system]</span>
<span id="cb292-13"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb292-13"></a>)</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-285"></span>
<img src="3rd_Edition_files/figure-html/unnamed-chunk-285-1.png" alt="Brain mass versus body mass for 33 species of male pinniped plotted on log scaled axes, orange symbols indicate non-harem breeders and green indicate harem breeders" width="672" />
<p class="caption">
Figure 10.4: Brain mass versus body mass for 33 species of male pinniped plotted on log scaled axes, orange symbols indicate non-harem breeders and green indicate harem breeders
</p>
</div>
<p>Maybe it would be helpful to draw in separate fitted lines for both mating systems. First we need to calculate the slopes and intercepts of the two fitted lines. If we were doing this as part of a formal analysis we’d do it all in one go with a general linear model with the mating system as a factor in the model, but for the sake of simplicity here we’ll just run two linear regressions and use the <code>subset =</code> argument to specify which mating system we’re using.</p>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb293-1"></a><span class="co">#Linear regression for harem breeders</span></span>
<span id="cb293-2"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb293-2"></a>harem_mod &lt;-</span>
<span id="cb293-3"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb293-3"></a><span class="st">  </span><span class="kw">lm</span>(<span class="kw">log</span>(Male_brain) <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(Male_mass),</span>
<span id="cb293-4"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb293-4"></a>     <span class="dt">data =</span> pinniped,</span>
<span id="cb293-5"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb293-5"></a>     <span class="dt">subset =</span> Mating_system <span class="op">==</span><span class="st"> &quot;Harem&quot;</span>)</span>
<span id="cb293-6"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb293-6"></a></span>
<span id="cb293-7"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb293-7"></a><span class="co">#Linear regression for non harem breeders</span></span>
<span id="cb293-8"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb293-8"></a>non_harem_mod &lt;-</span>
<span id="cb293-9"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb293-9"></a><span class="st">  </span><span class="kw">lm</span>(<span class="kw">log</span>(Male_brain) <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(Male_mass),</span>
<span id="cb293-10"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb293-10"></a>     <span class="dt">data =</span> pinniped,</span>
<span id="cb293-11"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb293-11"></a>     <span class="dt">subset =</span> Mating_system <span class="op">==</span><span class="st"> &quot;Non harem&quot;</span>)</span>
<span id="cb293-12"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb293-12"></a></span>
<span id="cb293-13"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb293-13"></a><span class="co">#Slope and intercept for harem breeders</span></span>
<span id="cb293-14"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb293-14"></a><span class="kw">coef</span>(harem_mod)</span>
<span id="cb293-15"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb293-15"></a>   (Intercept) <span class="kw">log</span>(Male_mass) </span>
<span id="cb293-16"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb293-16"></a>       <span class="fl">4.00515</span>        <span class="fl">0.37765</span> </span>
<span id="cb293-17"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb293-17"></a></span>
<span id="cb293-18"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb293-18"></a><span class="co">#Slope and intercept for non-harem breeders</span></span>
<span id="cb293-19"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb293-19"></a><span class="kw">coef</span>(non_harem_mod)</span>
<span id="cb293-20"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb293-20"></a>   (Intercept) <span class="kw">log</span>(Male_mass) </span>
<span id="cb293-21"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb293-21"></a>       <span class="fl">2.07789</span>        <span class="fl">0.75439</span> </span></code></pre></div>
<p>Now we can add these fitted lines to our plot. One option, and by far the easiest, is to use <code>abline()</code>.</p>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb294-1"></a></span>
<span id="cb294-2"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb294-2"></a><span class="kw">plot</span>(<span class="kw">log</span>(pinniped<span class="op">$</span>Male_brain) <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(pinniped<span class="op">$</span>Male_mass),</span>
<span id="cb294-3"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb294-3"></a>     <span class="dt">xlab =</span> <span class="st">&quot;Log body mass (Kg)&quot;</span>,</span>
<span id="cb294-4"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb294-4"></a>     <span class="dt">ylab =</span> <span class="st">&quot;Log brain mass (g)&quot;</span>, </span>
<span id="cb294-5"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb294-5"></a>     <span class="dt">pch =</span> <span class="dv">16</span>,</span>
<span id="cb294-6"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb294-6"></a>     <span class="dt">col =</span> colours[Mating_system])</span>
<span id="cb294-7"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb294-7"></a></span>
<span id="cb294-8"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb294-8"></a><span class="kw">abline</span>(harem_mod, <span class="dt">col =</span> colours[<span class="dv">1</span>], <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb294-9"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb294-9"></a><span class="kw">abline</span>(non_harem_mod, <span class="dt">col =</span> colours[<span class="dv">2</span>], <span class="dt">lwd =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-287"></span>
<img src="3rd_Edition_files/figure-html/unnamed-chunk-287-1.png" alt="Brain mass versus body mass for 33 species of male pinniped plotted on log scaled axes, orange symbols indicate non-harem breeders and green indicate harem breeders. Lines indicate fitted linear regressions." width="672" />
<p class="caption">
Figure 10.5: Brain mass versus body mass for 33 species of male pinniped plotted on log scaled axes, orange symbols indicate non-harem breeders and green indicate harem breeders. Lines indicate fitted linear regressions.
</p>
</div>
<p>That’s OK… but not fantastic. The fitted lines go across the whole of the graph and in the case of the non-harem breeders especially end up a long way outside the limits of the data we’ve fitted them to. It would be much better to only draw the lines within the minima and maxima of the data we’ve used. There are a variety of ways to do this: we can use the <code>clip()</code> function to make sure that <code>abline()</code> draws within the area we want, or we can draw our fitted lines using the <code>lines()</code> function. The latter is probably the most common way to do this so we’ll do it first but it’s also a bit more complicated than using <code>clip()</code>. <code>lines()</code> draws lines between specified x and y coordinates on a plot, so we need to know the minimum and maximum x values for our two groups of data and then calculate the y values for the lines corresponding to those data points. We can extract these values using the <code>min()</code> and <code>max()</code> functions, or we can do it in one go with the <code>summary()</code> function.</p>
<p>We need to remember to use <code>log()</code> to transform our data and also to use a subscript to specify that we only want the data points for which <code>Mating_system == "Harem"</code> is <code>TRUE</code>.Here’s what we get from <code>summary()</code>:</p>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb295-1"></a><span class="kw">summary</span>(<span class="kw">log</span>(pinniped<span class="op">$</span>Male_mass[Mating_system <span class="op">==</span><span class="st"> &quot;Harem&quot;</span>]))</span>
<span id="cb295-2"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb295-2"></a>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span id="cb295-3"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb295-3"></a>   <span class="fl">4.17</span>    <span class="fl">4.94</span>    <span class="fl">5.50</span>    <span class="fl">5.69</span>    <span class="fl">6.00</span>    <span class="fl">8.16</span> </span></code></pre></div>
<p>So we can generate a vector with the minimum and maximum values for x for harem breeders</p>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb296-1"></a></span>
<span id="cb296-2"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb296-2"></a>harem_x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">4.17</span>, <span class="fl">8.16</span>)</span></code></pre></div>
<p>For non-harem breeders:</p>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb297-1"></a><span class="kw">summary</span>(<span class="kw">log</span>(pinniped<span class="op">$</span>Male_mass[Mating_system <span class="op">==</span><span class="st"> &quot;Non harem&quot;</span>]))</span>
<span id="cb297-2"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb297-2"></a>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span id="cb297-3"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb297-3"></a>   <span class="fl">4.26</span>    <span class="fl">4.56</span>    <span class="fl">5.01</span>    <span class="fl">5.03</span>    <span class="fl">5.52</span>    <span class="fl">5.84</span> </span>
<span id="cb297-4"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb297-4"></a></span>
<span id="cb297-5"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb297-5"></a>non_harem_x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">4.26</span>, <span class="fl">5.84</span>)</span></code></pre></div>
<p>Now we need to calculate the corresponding y values and we can draw our lines. We know that the equations for our two lines are</p>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb298-1"></a>harem_y &lt;-<span class="st"> </span><span class="kw">coef</span>(harem_mod)[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span><span class="kw">coef</span>(harem_mod)[<span class="dv">2</span>] <span class="op">*</span><span class="st"> </span>harem_x</span>
<span id="cb298-2"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb298-2"></a>non_harem_y &lt;-<span class="st"> </span><span class="kw">coef</span>(non_harem_mod)[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span><span class="kw">coef</span>(non_harem_mod)[<span class="dv">2</span>] <span class="op">*</span><span class="st"> </span>non_harem_x</span></code></pre></div>
<p>Now we can use ‘lines()’ to draw the two regression lines onto our plot.</p>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb299-1"></a></span>
<span id="cb299-2"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb299-2"></a><span class="kw">plot</span>(<span class="kw">log</span>(pinniped<span class="op">$</span>Male_brain) <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(pinniped<span class="op">$</span>Male_mass),</span>
<span id="cb299-3"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb299-3"></a>     <span class="dt">xlab =</span> <span class="st">&quot;Log body mass (Kg)&quot;</span>,</span>
<span id="cb299-4"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb299-4"></a>     <span class="dt">ylab =</span> <span class="st">&quot;Log brain mass (g)&quot;</span>, </span>
<span id="cb299-5"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb299-5"></a>     <span class="dt">pch =</span> <span class="dv">16</span>,</span>
<span id="cb299-6"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb299-6"></a>     <span class="dt">col =</span> colours[Mating_system])</span>
<span id="cb299-7"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb299-7"></a></span>
<span id="cb299-8"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb299-8"></a><span class="kw">lines</span>(<span class="dt">x =</span> harem_x, <span class="dt">y =</span> harem_y, <span class="dt">col =</span> colours[<span class="dv">1</span>], <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb299-9"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb299-9"></a><span class="kw">lines</span>(<span class="dt">x =</span> non_harem_x, <span class="dt">y =</span> non_harem_y, <span class="dt">col =</span> colours[<span class="dv">2</span>], <span class="dt">lwd =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-292"></span>
<img src="3rd_Edition_files/figure-html/unnamed-chunk-292-1.png" alt="Brain mass versus body mass for 33 species of male pinniped plotted on log scaled axes, orange symbols indicate non-harem breeders and green indicate harem breeders. Lines indicate fitted linear regressions." width="672" />
<p class="caption">
Figure 10.6: Brain mass versus body mass for 33 species of male pinniped plotted on log scaled axes, orange symbols indicate non-harem breeders and green indicate harem breeders. Lines indicate fitted linear regressions.
</p>
</div>
<p>That’s a much more acceptable plot than the previous version and we are not extrapolating our lines beyond the limits of the data that they are calculated from. How about using <code>clip()</code> and <code>abline()</code> to do the same thing? What you need to know here is that <code>clip()</code> sets the area of the graph on which it is possible to draw things like lines, points and text. This is normally simply defined by the limits of the x- and y-axes, but we can define our own area if necessary. <code>clip()</code> takes four arguments, x1, x2, y1 and y2 which are the lower and upper limits of the clip region in x- and y-coordinates respectively, and you need to supply all of them: there are no defaults. We already have the minimum and maximum x-values calculated for harem and non-harem breeders, and for the y-values we’ll just use a small minimum and a big maximum since we’re not concerned about those as limits for our line. We have to set a different clip area for each line, of course.</p>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb300-1"></a></span>
<span id="cb300-2"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb300-2"></a><span class="kw">plot</span>(<span class="kw">log</span>(pinniped<span class="op">$</span>Male_brain) <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(pinniped<span class="op">$</span>Male_mass),</span>
<span id="cb300-3"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb300-3"></a>     <span class="dt">xlab =</span> <span class="st">&quot;Log body mass (Kg)&quot;</span>,</span>
<span id="cb300-4"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb300-4"></a>     <span class="dt">ylab =</span> <span class="st">&quot;Log brain mass (g)&quot;</span>, </span>
<span id="cb300-5"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb300-5"></a>     <span class="dt">pch =</span> <span class="dv">16</span>,</span>
<span id="cb300-6"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb300-6"></a>     <span class="dt">col =</span> colours[Mating_system])</span>
<span id="cb300-7"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb300-7"></a></span>
<span id="cb300-8"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb300-8"></a><span class="kw">clip</span>(<span class="dt">x1 =</span> harem_x[<span class="dv">1</span>], <span class="dt">x2 =</span> harem_x[<span class="dv">2</span>], <span class="dt">y1 =</span> <span class="dv">4</span>, <span class="dt">y2 =</span> <span class="dv">8</span>)</span>
<span id="cb300-9"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb300-9"></a><span class="kw">abline</span>(harem_mod, <span class="dt">col =</span> colours[<span class="dv">1</span>], <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb300-10"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb300-10"></a></span>
<span id="cb300-11"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb300-11"></a><span class="kw">clip</span>(<span class="dt">x1 =</span> non_harem_x[<span class="dv">1</span>], <span class="dt">x2 =</span> non_harem_x[<span class="dv">2</span>], <span class="dt">y1 =</span> <span class="dv">4</span>, <span class="dt">y2 =</span> <span class="dv">8</span>)</span>
<span id="cb300-12"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb300-12"></a><span class="kw">abline</span>(non_harem_mod, <span class="dt">col =</span> colours[<span class="dv">2</span>], <span class="dt">lwd =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-293"></span>
<img src="3rd_Edition_files/figure-html/unnamed-chunk-293-1.png" alt="Brain mass versus body mass for 33 species of male pinniped plotted on log scaled axes, orange symbols indicate non-harem breeders and green indicate harem breeders. Lines indicate fitted linear regressions." width="672" />
<p class="caption">
Figure 10.7: Brain mass versus body mass for 33 species of male pinniped plotted on log scaled axes, orange symbols indicate non-harem breeders and green indicate harem breeders. Lines indicate fitted linear regressions.
</p>
</div>
<p>There we go, the exact same graph as before but generated in a rather different way. One thing that’s really important to remember when using <code>clip()</code> is that the clipping region will stay as the area you’ve specified if you want to add anything else, say a legend, to your plot. If you want to return to the default clipping area you can use this code:</p>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb301-1"></a><span class="kw">do.call</span>(<span class="st">&quot;clip&quot;</span>, <span class="kw">as.list</span>(<span class="kw">par</span>(<span class="st">&quot;usr&quot;</span>)))</span></code></pre></div>
<p><code>par("usr")</code> gives the original clipping region of the graph as defined by the x- and y-axis minima and maxima. <code>do.call()</code> is a function which will execute a specified function from the name of the function and a list of the arguments to be passed to it, so we use <code>as.list()</code> to convert the output from <code>par("usr")</code> to a list and use the <code>do.call()</code> function with “clip” as the first argument. The alternative would be to do something like this:</p>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb302-1"></a>x1 &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="st">&quot;usr&quot;</span>)</span>
<span id="cb302-2"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb302-2"></a><span class="kw">clip</span>(<span class="dt">x1 =</span> x1[<span class="dv">1</span>], <span class="dt">x2 =</span> x1[<span class="dv">2</span>], <span class="dt">y1 =</span> x1[<span class="dv">3</span>], <span class="dt">y2 =</span> x1[<span class="dv">4</span>])</span></code></pre></div>
<p>which is maybe a bit clunkier but also simpler and will do exactly the same.</p>
</div>
<div id="legends" class="section level2">
<h2><span class="header-section-number">10.3</span> Legends</h2>
<p>Our plot needs a legend to let the reader know what the colour coding means. We’ve already seen one example of adding a legend in the previous chapter, but let’s take another look.</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb303-1"></a><span class="kw">plot</span>(<span class="kw">log</span>(pinniped<span class="op">$</span>Male_brain) <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(pinniped<span class="op">$</span>Male_mass),</span>
<span id="cb303-2"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb303-2"></a>     <span class="dt">xlab =</span> <span class="st">&quot;Log body mass (Kg)&quot;</span>,</span>
<span id="cb303-3"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb303-3"></a>     <span class="dt">ylab =</span> <span class="st">&quot;Log brain mass (g)&quot;</span>, </span>
<span id="cb303-4"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb303-4"></a>     <span class="dt">pch =</span> <span class="dv">16</span>,</span>
<span id="cb303-5"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb303-5"></a>     <span class="dt">col =</span> colours[Mating_system])</span>
<span id="cb303-6"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb303-6"></a></span>
<span id="cb303-7"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb303-7"></a><span class="kw">clip</span>(harem_x[<span class="dv">1</span>], harem_x[<span class="dv">2</span>], <span class="dv">4</span>,<span class="dv">8</span>)</span>
<span id="cb303-8"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb303-8"></a><span class="kw">abline</span>(harem_mod, <span class="dt">col =</span> colours[<span class="dv">1</span>], <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb303-9"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb303-9"></a></span>
<span id="cb303-10"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb303-10"></a><span class="kw">clip</span>(non_harem_x[<span class="dv">1</span>], non_harem_x[<span class="dv">2</span>], <span class="dv">4</span>,<span class="dv">8</span>)</span>
<span id="cb303-11"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb303-11"></a><span class="kw">abline</span>(non_harem_mod, <span class="dt">col =</span> colours[<span class="dv">2</span>], <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb303-12"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb303-12"></a></span>
<span id="cb303-13"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb303-13"></a><span class="kw">do.call</span>(<span class="st">&quot;clip&quot;</span>, <span class="kw">as.list</span>(<span class="kw">par</span>(<span class="st">&quot;usr&quot;</span>)))</span>
<span id="cb303-14"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb303-14"></a></span>
<span id="cb303-15"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb303-15"></a><span class="kw">legend</span>(<span class="st">&quot;topleft&quot;</span>,</span>
<span id="cb303-16"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb303-16"></a>  <span class="dt">legend =</span> <span class="kw">c</span>(<span class="st">&quot;Harem&quot;</span>, <span class="st">&quot;Non harem&quot;</span>),</span>
<span id="cb303-17"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb303-17"></a>  <span class="dt">col =</span> colours,</span>
<span id="cb303-18"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb303-18"></a>  <span class="dt">pch  =</span> <span class="dv">16</span>,</span>
<span id="cb303-19"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb303-19"></a>  <span class="dt">lty =</span> <span class="dv">1</span>,</span>
<span id="cb303-20"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb303-20"></a>  <span class="dt">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb303-21"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb303-21"></a>  <span class="dt">bty =</span> <span class="st">&quot;n&quot;</span>,</span>
<span id="cb303-22"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb303-22"></a>  <span class="dt">title =</span> <span class="kw">expression</span>(<span class="kw">bold</span>(<span class="st">&quot;Mating system&quot;</span>)))</span></code></pre></div>
<div class="figure"><span id="fig:graph11a"></span>
<img src="3rd_Edition_files/figure-html/graph11a-1.png" alt="Brain mass versus body mass for 33 species of male pinniped plotted on log scaled axes, colour coded for mating system with legend" width="672" />
<p class="caption">
Figure 10.8: Brain mass versus body mass for 33 species of male pinniped plotted on log scaled axes, colour coded for mating system with legend
</p>
</div>
<p>The first piece of code plots the data, then the second adds the legend. It’s got quite a few arguments so let’s run through them individually. <code>"topleft"</code> tells <code>legend()</code> where to put the legend. There are a number of options for this so <code>"bottomright"</code> would put it in the bottom right hand corner and <code>"top"</code> would place it in the middle of the top. You can find all the options if you look in the “Details” section of the <code>legend()</code> help file.</p>
<p>If you want to be specific about where your legend goes you can use x and y coordinates instead of text descriptions — you might remember that in the previous chapter we used this along with setting <code>par(xdp) = TRUE)</code> to add a legend to the right of the plot area. Lots of the R functions which add elements to graphs use coordinates, and it’s straightforward to use them because they are on the same scale that the points are plotted on. <code>legend()</code> puts the top left corner of the legend at the specified point so if you replaced <code>legend("topright",...</code> with <code>legend(x = 4.01, y = 7.35,...</code> you’d get a very similar result.</p>
<p>The confusingly-named argument <code>legend =</code> gives the text that goes in the legend, in this case as a character vector with two elements. <code>legend()</code> will generate a legend with one entry for each element in the vector, so in this case we’ll get two entries. <code>col = colours</code> tells it what colours to associate with each entry, and then we specify both a plot symbol (<code>pch = 16</code>) and a line type and width (<code>lty = 1, lwd = 2</code>). This gives us both a line and a plot symbol in the appropriate colour. If we’d only specified a plot symbol or a line type then we’d only have got one of the two.</p>
<p><code>bty = "n"</code> means that we have a legend without a box drawn around it. Finally we give a title for the legend: <code>title = expression(bold("Mating system"))</code>. If we just wanted this in standard text we would simply have input <code>title = "Mating system"</code> but it looks better to have this in bold. Consequently we’re using the <code>expression()</code> function which gives us a lot of control over our text, and allows us to have the title in bold.</p>
<p>As an aside, for “normal” text on a plot such as axis labels we can specify bold or italic using one of the <code>font...</code> parameters as an argument, so if you want the axis labels in bold then <code>..., font.lab = 2</code> will do the trick, or if you want the main title in italics then <code>...., font.main = 3</code>. This doesn’t work for text in a legend, however, so we have to use more complex methods.</p>
</div>
<div id="curves" class="section level2">
<h2><span class="header-section-number">10.4</span> Curves</h2>
<div id="adding-a-curve-using-curve" class="section level3">
<h3><span class="header-section-number">10.4.1</span> Adding a curve using <code>curve()</code></h3>
<p>Very often, of course, relationships between two variables are best described by a curve rather than a straight line. We’re going to abanodon the seals and sealions for a while because of a lack of suitable curves and go back to our World Bank data. Here’s the relationship between a country’s CO<sub>2</sub> emissions in metric tonnes per capita and the GNP per capita. Both of these are plotted on a log<sub>10</sub> scale.</p>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb304-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb304-1"></a>logCO2 &lt;-<span class="st"> </span><span class="kw">log10</span>(WB<span class="op">$</span>CO2)</span>
<span id="cb304-2"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb304-2"></a>logGNP &lt;-<span class="st"> </span><span class="kw">log10</span>(WB<span class="op">$</span>GNP)</span>
<span id="cb304-3"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb304-3"></a></span>
<span id="cb304-4"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb304-4"></a><span class="kw">plot</span>(logCO2 <span class="op">~</span><span class="st"> </span>logGNP,</span>
<span id="cb304-5"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb304-5"></a>     <span class="dt">col =</span> <span class="st">&quot;steelblue&quot;</span>,</span>
<span id="cb304-6"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb304-6"></a>     <span class="dt">xlab =</span> <span class="st">&quot;Log GNP per capita&quot;</span>,</span>
<span id="cb304-7"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb304-7"></a>     <span class="dt">ylab =</span> <span class="st">&quot;Log Carbon dioxide emissions per capita&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-297"></span>
<img src="3rd_Edition_files/figure-html/unnamed-chunk-297-1.png" alt="CO2 emissions per capita versus GNP per capita by country" width="672" />
<p class="caption">
Figure 10.9: CO2 emissions per capita versus GNP per capita by country
</p>
</div>
<p>There’s a clear decrease in the slope of the relationship as GNP per capita increases. There are a variety of possible ways to describe such a relationship but one of the simplest is to use a <em>second order polynomial</em> also known as a <em>quadratic</em> equation. These take the form</p>
<p><span class="math display">\[ y = \beta _{1} + \beta_{2}x + \beta_{3}x^{2} \]</span>
and have the big advantage that since they are mathematically linear we can estimate them using a linear model rather than one of those tricksy non-linear ones.</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb305-1"></a><span class="co"># Fit model</span></span>
<span id="cb305-2"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb305-2"></a>poly1 &lt;-<span class="st"> </span><span class="kw">lm</span>(logCO2 <span class="op">~</span><span class="st"> </span>logGNP <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(logGNP<span class="op">^</span><span class="dv">2</span>))</span>
<span id="cb305-3"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb305-3"></a></span>
<span id="cb305-4"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb305-4"></a><span class="co"># Show coefficients</span></span>
<span id="cb305-5"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb305-5"></a><span class="kw">coef</span>(poly1)</span>
<span id="cb305-6"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb305-6"></a>(Intercept)      logGNP <span class="kw">I</span>(logGNP<span class="op">^</span><span class="dv">2</span>) </span>
<span id="cb305-7"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb305-7"></a>   <span class="fl">-7.97986</span>     <span class="fl">3.53398</span>    <span class="fl">-0.34562</span> </span></code></pre></div>
<p>We’re not going to worry about the details of the model or whether it is statistically significant for the moment, we’re just using it to produce estimates of our three coefficients. Now we know the formula for our curve, which is</p>
<p><span class="math display">\[ log_{10} \mathrm{CO}_{2} = -7.98 + 3.53 \times log_{10} \mathrm{GNP} - 0.346 \times log_{10} \mathrm{GNP} ^{2} \]</span>
we can add it onto our graph. R being R of course there are many ways to do this: we can draw it in with <code>lines()</code>, we can draw it in with <code>points()</code> if we tell <code>points()</code> to draw a line,<a href="#fn12" class="footnote-ref" id="fnref12"><sup>12</sup></a> and we can add it to the plot using <code>curve()</code>.</p>
<p>Here’s the last option, using <code>curve()</code>.</p>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb306-1"></a></span>
<span id="cb306-2"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb306-2"></a><span class="co"># Plot graph</span></span>
<span id="cb306-3"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb306-3"></a><span class="kw">plot</span>(logCO2 <span class="op">~</span><span class="st"> </span>logGNP,</span>
<span id="cb306-4"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb306-4"></a>     <span class="dt">col =</span> <span class="st">&quot;steelblue&quot;</span>,</span>
<span id="cb306-5"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb306-5"></a>     <span class="dt">xlab =</span> <span class="st">&quot;Log GNP per capita&quot;</span>,</span>
<span id="cb306-6"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb306-6"></a>     <span class="dt">ylab =</span> <span class="st">&quot;Log Carbon dioxide emissions per capita&quot;</span>)</span>
<span id="cb306-7"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb306-7"></a></span>
<span id="cb306-8"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb306-8"></a><span class="co"># Add curve</span></span>
<span id="cb306-9"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb306-9"></a><span class="kw">curve</span>(<span class="op">-</span><span class="fl">7.98</span> <span class="op">+</span><span class="st"> </span><span class="fl">3.53</span> <span class="op">*</span><span class="st"> </span>x <span class="fl">-0.346</span> <span class="op">*</span><span class="st"> </span>x<span class="op">^</span><span class="dv">2</span>,</span>
<span id="cb306-10"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb306-10"></a>      <span class="dt">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb306-11"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb306-11"></a>      <span class="dt">col =</span> <span class="st">&quot;cadetblue4&quot;</span>,</span>
<span id="cb306-12"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb306-12"></a>      <span class="dt">add =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-299"></span>
<img src="3rd_Edition_files/figure-html/unnamed-chunk-299-1.png" alt="CO2 emissions per capita versus GNP per capita by country. Line shows a fitted quadratic curve" width="672" />
<p class="caption">
Figure 10.10: CO2 emissions per capita versus GNP per capita by country. Line shows a fitted quadratic curve
</p>
</div>
<p>Quadratic curves are fairly simple beasts and in particular the rate at which the slope changes is constant across the whole thing, so the fit heere is really surprisingly good. Let’s look at that <code>curve()</code> function call in a bit more detail.</p>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb307-1"></a><span class="kw">curve</span>(<span class="op">-</span><span class="fl">7.98</span> <span class="op">+</span><span class="st"> </span><span class="fl">3.53</span> <span class="op">*</span><span class="st"> </span>x <span class="fl">-0.346</span> <span class="op">*</span><span class="st"> </span>x<span class="op">^</span><span class="dv">2</span>,</span>
<span id="cb307-2"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb307-2"></a>      <span class="dt">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb307-3"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb307-3"></a>      <span class="dt">col =</span> <span class="st">&quot;cadetblue4&quot;</span>,</span>
<span id="cb307-4"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb307-4"></a>      <span class="dt">add =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p>The first argument is the actual formula of the curve we’d like to draw. This is only the right hand side of the equation: the <em>y = </em> bit is assumed to be there. It’s written out using the normal R arithmetic operators and is hopefully self explanatory. We then specify the width of the line as twice the default option <code>lwd = 2</code> and set the colour. The last argument is an important one: <code>add = TRUE</code>. This is needed because <code>curve()</code> is not a function like <code>lines()</code> or <code>text()</code> that adds elements to existing graphs by default: rather it draws a new graph in the same way that <code>plot()</code> would unless we tell it to add what it’s drawing to an existing graph.</p>
</div>
<div id="adding-a-curve-using-lines-or-points." class="section level3">
<h3><span class="header-section-number">10.4.2</span> Adding a curve using <code>lines()</code> or <code>points()</code>.</h3>
<p>Here’s another data set. We’re moving from the world of CO<sub>2</sub> emissions measured on a national scale to thinking about the weapons used by male beetles when they fight over females.</p>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb308-1"></a>beetle&lt;-<span class="kw">read.table</span>(<span class="st">&quot;http://www.introductoryr.co.uk/beetles.txt&quot;</span>,<span class="dt">header=</span>T)</span></code></pre></div>
<p>The beetle dataset has horn length and body size (as measured across the pronotum, the first segment of the thorax) measurements for two species of dung beetle, <em>Euoniticellus intermedius</em> and <em>Onthophagus taurus</em>. We’ll look at the latter at the moment. <em>O. taurus</em> is an insect which has been heavily studied by behavioural ecologists because the males develop into two types: “minor” males with small or no horns, which acquire matings without aggression using what are called “sneaky” tactics, and “major” males which develop horns and who guard females and fight with other males in order to monopolise access to them. Whether a male develops into a minor or a major depends on its body size, and if we plot horn length against body size we get a sigmoid relationship.</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb309-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb309-1"></a></span>
<span id="cb309-2"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb309-2"></a><span class="kw">plot</span>(beetle<span class="op">$</span>taurus_horn <span class="op">~</span><span class="st"> </span>beetle<span class="op">$</span>taurus_pron,</span>
<span id="cb309-3"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb309-3"></a>     <span class="dt">col =</span> <span class="st">&quot;aquamarine4&quot;</span>,</span>
<span id="cb309-4"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb309-4"></a>     <span class="dt">xlab =</span> <span class="st">&quot;Pronotum width (mm)&quot;</span>,</span>
<span id="cb309-5"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb309-5"></a>     <span class="dt">ylab =</span> <span class="st">&quot;Horn length (mm)&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-302"></span>
<img src="3rd_Edition_files/figure-html/unnamed-chunk-302-1.png" alt="Horn length plotted against body size as indicated by pronotum width for male *Onthophagus taurus*" width="672" />
<p class="caption">
Figure 10.11: Horn length plotted against body size as indicated by pronotum width for male <em>Onthophagus taurus</em>
</p>
</div>
<p>You can see that there is a “switchpoint” at a pronotum width of roughly 4.8mm, with beetles below this size having very reduced horns and beetles above this size having large horns. We’d like to draw a curve through these data to indicate the shape of the relationship. One option is to fit an equation of the form:</p>
<p><span class="math display">\[ horn \: length  = y_{0} + \frac{a \times body \: size^{b}}{c^{b} + body \: size^{b}}. \]</span></p>
<p>To do this we need to carry out a non-linear fit, which we don’t need to go into the details of. Just trust me when I say that our fitted model gives a set of estimates for the coefficients of:</p>
<p><em>y<sub>0</sub></em> = 0.41,<br />
<em>a</em> = 3.99,<br />
<em>b</em> = 45.76 &amp;<br />
<em>c</em> = 5.01,</p>
<p>giving us an equation for our curve of:</p>
<p><span class="math display">\[ horn \: length  = 0.41 + \frac{3.99 \times body \: size^{45.76}}{5.01^{45.76} + body \: size^{45.76}}. \]</span></p>
<p>We could draw this in using <code>curve()</code> but instead we’re going to use a different method. We’ll start by setting up a dummy x-variable with a sequence of points running from the minimum and maximum points where you want the curve to run from and to, and then we’ll calculate the corresponding y-variables and draw them in with <code>lines()</code>. Previously we’ve used <code>lines()</code> to draw straight lines, but if you give it more than two x- and y- coordinates it will connect them together. Because we’re using 200 points what is drawn comes out looking like a smooth curve. Note that you can get the exact same result by using <code>points()</code>, with the <code>type</code> argument set to <code>type="l"</code>… which makes it draw lines.</p>
<p>Here is our dummy x-variable.</p>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb310-1"></a>X1 &lt;-</span>
<span id="cb310-2"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb310-2"></a><span class="st">  </span><span class="kw">seq</span>(</span>
<span id="cb310-3"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb310-3"></a>    <span class="dt">from =</span> <span class="kw">min</span>(beetle<span class="op">$</span>taurus_pron, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</span>
<span id="cb310-4"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb310-4"></a>    <span class="dt">to =</span> <span class="kw">max</span>(beetle<span class="op">$</span>taurus_pron, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</span>
<span id="cb310-5"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb310-5"></a>    <span class="dt">length =</span> <span class="dv">200</span></span>
<span id="cb310-6"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb310-6"></a>  )</span></code></pre></div>
<p>This will give us 200 evenly spaced numbers across the range of pronotum widths. Now we need to work out the corresponding y values.</p>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb311-1"></a>Y1 &lt;-<span class="st"> </span><span class="fl">0.41</span> <span class="op">+</span><span class="st"> </span>(<span class="fl">3.99</span> <span class="op">*</span><span class="st"> </span>(X1 <span class="op">^</span><span class="st"> </span><span class="fl">45.76</span>)) <span class="op">/</span><span class="st"> </span>(<span class="fl">5.01</span> <span class="op">^</span><span class="st"> </span><span class="fl">45.76</span> <span class="op">+</span><span class="st"> </span>(X1 <span class="op">^</span><span class="st"> </span><span class="fl">45.76</span>))</span></code></pre></div>
<p>Finally, we can re-plot our graph and draw in the curve using <code>lines()</code>.</p>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb312-1"></a><span class="kw">plot</span>(beetle<span class="op">$</span>taurus_horn <span class="op">~</span><span class="st"> </span>beetle<span class="op">$</span>taurus_pron,</span>
<span id="cb312-2"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb312-2"></a>     <span class="dt">col =</span> <span class="st">&quot;aquamarine4&quot;</span>,</span>
<span id="cb312-3"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb312-3"></a>     <span class="dt">xlab =</span> <span class="st">&quot;Pronotum width (mm)&quot;</span>,</span>
<span id="cb312-4"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb312-4"></a>     <span class="dt">ylab =</span> <span class="st">&quot;Horn length (mm)&quot;</span>)</span>
<span id="cb312-5"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb312-5"></a></span>
<span id="cb312-6"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb312-6"></a><span class="kw">lines</span>(X1,Y1)</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-305"></span>
<img src="3rd_Edition_files/figure-html/unnamed-chunk-305-1.png" alt="Horn length versus pronotum width for O. taurus with fitted curve" width="672" />
<p class="caption">
Figure 10.12: Horn length versus pronotum width for O. taurus with fitted curve
</p>
</div>
<p>The first method we’ve seen for adding curves to a plot, using <code>curve()</code>, is simplest when you have a straightforward equation to describe your curve. The second comes in handy in lots of other situations though, such as when you have a complex model and you want to draw a line showing the fitted model. In this case you can use the <code>predict()</code> function to calculate your y values without having to worry about copying out all of the fitted model coefficients.</p>
</div>
</div>
<div id="text-and-arrows" class="section level2">
<h2><span class="header-section-number">10.5</span> Text and arrows</h2>
<p>Sometimes we want to add text to a plot, for example to indicate the identity of specific data points, or to show a specific event on a time series. Let’s take a break from our pinnipeds data and look at a different data set: this is the relative number of Google searches for the term “Springboks” carried out in South Africa during the period September 1st to December 1st during the year 2019. For those who don’t know, the Springboks are the South African rugby team and the Rugby World Cup was held in September, October and December of 2019. The data include dates, and we’re going to use the <code>ymd()</code> function from the <em>lubridate</em> package to convert the text which was downloaded from Google Trends into date formatted data for R.</p>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb313-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb313-1"></a><span class="co"># Load data</span></span>
<span id="cb313-2"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb313-2"></a>rugby &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;Data/SA_Springboks_searches.csv&quot;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</span>
<span id="cb313-3"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb313-3"></a></span>
<span id="cb313-4"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb313-4"></a><span class="co"># Load lubridate package</span></span>
<span id="cb313-5"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb313-5"></a><span class="kw">library</span>(lubridate)</span>
<span id="cb313-6"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb313-6"></a></span>
<span id="cb313-7"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb313-7"></a><span class="co"># Convert Week data to Date format</span></span>
<span id="cb313-8"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb313-8"></a>rugby<span class="op">$</span>Date &lt;-<span class="st"> </span><span class="kw">ymd</span>(rugby<span class="op">$</span>Date)</span>
<span id="cb313-9"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb313-9"></a></span>
<span id="cb313-10"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb313-10"></a><span class="kw">str</span>(rugby)</span>
<span id="cb313-11"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb313-11"></a><span class="st">&#39;data.frame&#39;</span><span class="op">:</span><span class="st">   </span><span class="dv">91</span> obs. of  <span class="dv">2</span> variables<span class="op">:</span></span>
<span id="cb313-12"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb313-12"></a><span class="st"> </span><span class="er">$</span><span class="st"> </span>Date    <span class="op">:</span><span class="st"> </span>Date, format<span class="op">:</span><span class="st"> &quot;2019-09-01&quot;</span> <span class="st">&quot;2019-09-02&quot;</span> ...</span>
<span id="cb313-13"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb313-13"></a> <span class="op">$</span><span class="st"> </span>Searches<span class="op">:</span><span class="st"> </span>int  <span class="dv">1</span> <span class="dv">1</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">4</span> <span class="dv">24</span> <span class="dv">4</span> <span class="dv">2</span> <span class="dv">1</span> <span class="dv">1</span> ...</span></code></pre></div>
<p>All looks good. Let’s plot that out.</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb314-1"></a><span class="co"># Plot graph</span></span>
<span id="cb314-2"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb314-2"></a><span class="kw">plot</span>(rugby<span class="op">$</span>Searches <span class="op">~</span><span class="st"> </span>rugby<span class="op">$</span>Date, </span>
<span id="cb314-3"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb314-3"></a>     <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, </span>
<span id="cb314-4"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb314-4"></a>     <span class="dt">col =</span> <span class="st">&quot;steelblue&quot;</span>, </span>
<span id="cb314-5"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb314-5"></a>     <span class="dt">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb314-6"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb314-6"></a>     <span class="dt">xlab =</span> <span class="st">&quot;Date&quot;</span>,</span>
<span id="cb314-7"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb314-7"></a>     <span class="dt">ylab =</span> <span class="st">&quot;Search intensity on Google&quot;</span>,</span>
<span id="cb314-8"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb314-8"></a>     <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">120</span>))</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-307"></span>
<img src="3rd_Edition_files/figure-html/unnamed-chunk-307-1.png" alt="Google searches for &quot;Springboks&quot; in South Africa from September to the beginning of December 2019" width="672" />
<p class="caption">
Figure 10.13: Google searches for “Springboks” in South Africa from September to the beginning of December 2019
</p>
</div>
<p>There are some obvious peaks in these data. Is it possible that these correspond to match days in the 2019 Rugby World Cup? The days that the Springboks played were:</p>
<table>
<thead>
<tr class="header">
<th align="left">Date</th>
<th align="left">Match</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2019-09-06</td>
<td align="left">Japan (warm up)</td>
</tr>
<tr class="even">
<td align="left">2019-09-21</td>
<td align="left">New Zealand</td>
</tr>
<tr class="odd">
<td align="left">2019-09-28</td>
<td align="left">Namibia</td>
</tr>
<tr class="even">
<td align="left">2019-10-04</td>
<td align="left">Italy</td>
</tr>
<tr class="odd">
<td align="left">2019-10-08</td>
<td align="left">Canada</td>
</tr>
<tr class="even">
<td align="left">2019-10-20</td>
<td align="left">Japan</td>
</tr>
<tr class="odd">
<td align="left">2019-10-27</td>
<td align="left">Wales</td>
</tr>
<tr class="even">
<td align="left">2019-11-02</td>
<td align="left">England (Final)</td>
</tr>
</tbody>
</table>
<p>In case anyone doesn’t know, the final match against England was the World Cup final in which South Africa soundly beat England to become World Champions for the third time. Let’s see how that first date corresponds with the peaks on our graph: we’re going to use <code>text()</code> to add some text indicating that the match was against New Zealand, and we’re going to use <code>arrows()</code> to indicate the exact point on our line.</p>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb315-1"></a><span class="co"># Plot graph</span></span>
<span id="cb315-2"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb315-2"></a><span class="kw">plot</span>(rugby<span class="op">$</span>Searches <span class="op">~</span><span class="st"> </span>rugby<span class="op">$</span>Date, </span>
<span id="cb315-3"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb315-3"></a>     <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, </span>
<span id="cb315-4"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb315-4"></a>     <span class="dt">col =</span> <span class="st">&quot;steelblue&quot;</span>, </span>
<span id="cb315-5"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb315-5"></a>     <span class="dt">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb315-6"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb315-6"></a>     <span class="dt">xlab =</span> <span class="st">&quot;Date&quot;</span>,</span>
<span id="cb315-7"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb315-7"></a>     <span class="dt">ylab =</span> <span class="st">&quot;Search intensity on Google&quot;</span>,</span>
<span id="cb315-8"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb315-8"></a>     <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">120</span>))</span>
<span id="cb315-9"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb315-9"></a></span>
<span id="cb315-10"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb315-10"></a><span class="co"># Add text</span></span>
<span id="cb315-11"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb315-11"></a><span class="kw">text</span>(<span class="dt">x =</span> <span class="kw">ymd</span>(<span class="st">&quot;2019-09-21&quot;</span>), </span>
<span id="cb315-12"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb315-12"></a>     <span class="dt">y =</span> <span class="dv">115</span>,</span>
<span id="cb315-13"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb315-13"></a>     <span class="dt">labels =</span> <span class="st">&quot;South Africa</span><span class="ch">\n</span><span class="st">vs.</span><span class="ch">\n</span><span class="st">New Zealand&quot;</span>, </span>
<span id="cb315-14"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb315-14"></a>     <span class="dt">cex =</span> <span class="fl">0.6</span>)</span>
<span id="cb315-15"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb315-15"></a></span>
<span id="cb315-16"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb315-16"></a><span class="co"># Add arrow</span></span>
<span id="cb315-17"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb315-17"></a><span class="kw">arrows</span>(<span class="dt">x0 =</span> <span class="kw">ymd</span>(<span class="st">&quot;2019-09-21&quot;</span>), </span>
<span id="cb315-18"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb315-18"></a>       <span class="dt">y0 =</span> <span class="dv">105</span>, </span>
<span id="cb315-19"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb315-19"></a>       <span class="dt">x1 =</span> <span class="kw">ymd</span>(<span class="st">&quot;2019-09-21&quot;</span>), </span>
<span id="cb315-20"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb315-20"></a>       <span class="dt">y1 =</span> rugby<span class="op">$</span>Searches[<span class="kw">which</span>(rugby<span class="op">$</span>Date <span class="op">==</span><span class="st"> &quot;2019-09-21&quot;</span>)] <span class="op">+</span><span class="st"> </span><span class="dv">5</span>,</span>
<span id="cb315-21"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb315-21"></a>       <span class="dt">length =</span> <span class="fl">0.08</span>,</span>
<span id="cb315-22"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb315-22"></a>       <span class="dt">lwd =</span> <span class="fl">0.8</span>)</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-308"></span>
<img src="3rd_Edition_files/figure-html/unnamed-chunk-308-1.png" alt="Google searches for &quot;Springboks&quot; in South Africa from September to the beginning of December 2019. The match versus New Zealand is indicated." width="672" />
<p class="caption">
Figure 10.14: Google searches for “Springboks” in South Africa from September to the beginning of December 2019. The match versus New Zealand is indicated.
</p>
</div>
<p>That looks pretty conclusive, at least in that case. Let’s look at the code we used to add the text and the arrow. Firstly, the text.</p>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb316-1"></a><span class="co"># Add text</span></span>
<span id="cb316-2"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb316-2"></a><span class="kw">text</span>(<span class="dt">x =</span> <span class="kw">ymd</span>(<span class="st">&quot;2019-09-21&quot;</span>), </span>
<span id="cb316-3"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb316-3"></a>     <span class="dt">y =</span> <span class="dv">115</span>,</span>
<span id="cb316-4"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb316-4"></a>     <span class="dt">labels =</span> <span class="st">&quot;South Africa</span><span class="ch">\n</span><span class="st">vs.</span><span class="ch">\n</span><span class="st">New Zealand&quot;</span>, </span>
<span id="cb316-5"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb316-5"></a>     <span class="dt">cex =</span> <span class="fl">0.6</span>)</span></code></pre></div>
<p>This show us some important points about the <code>text()</code> function. Firstly, we have some coordinates: <code>x = ymd(2019-09-21)</code> and <code>y = 115</code>. These tells R where to put the text within the plot area. One useful thing to notice is that the coordinates are given in terms of the x- and y-axis scales. The y-axis goes from 0 to 120, and we want something close to the top, so I picked 115. For the x-axis we want the date of the match against New Zealand: I’ve given this in the same format that the dates in our original data file are in and then I’ve used the <code>ymd()</code> function again to convert this into date format. By default R will draw the text centred on the coordinates given, but you can change this if you wish by using the <code>pos =</code> argument, whereby values of 1,2,3 or 4 indicate that text should go below, to the left, above or to the right of the coordinates given. You can also use the <code>adj =</code> argument to change the way the text is aligned with the coordinates: <code>adj = 0</code> will give text which is centred on the y-coordinate but which is left-justified to the x-coordinate, for example.</p>
<p>Following the coordinates we have the <code>labels =</code> argument which gives the text to be used. In this case I’ve made things more complicated than necessary again by including the <code>\n</code> character in the text. This indicates a new line within the text and is not read as straightforward text by R because of the use of the so-called “escape character”, <code>\</code> which indicates the use of something that should not just be preocessed as a set of characters. If we didn’t have these two new lines indicated by <code>\n</code>, and replaced them with spaces, our text would be displayed as a single line. Finally I’ve used <code>cex = 0.6</code> to make the text smaller than the default size.</p>
<p>How about those arrows then? Here’s the code.</p>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb317-1"></a><span class="co"># Add arrow</span></span>
<span id="cb317-2"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb317-2"></a><span class="kw">arrows</span>(<span class="dt">x0 =</span> <span class="kw">ymd</span>(<span class="st">&quot;2019-09-21&quot;</span>), </span>
<span id="cb317-3"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb317-3"></a>       <span class="dt">y0 =</span> <span class="dv">105</span>, </span>
<span id="cb317-4"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb317-4"></a>       <span class="dt">x1 =</span> <span class="kw">ymd</span>(<span class="st">&quot;2019-09-21&quot;</span>), </span>
<span id="cb317-5"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb317-5"></a>       <span class="dt">y1 =</span> rugby<span class="op">$</span>Searches[<span class="kw">which</span>(rugby<span class="op">$</span>Date <span class="op">==</span><span class="st"> &quot;2019-09-21&quot;</span>)] <span class="op">+</span><span class="st"> </span><span class="dv">5</span>,</span>
<span id="cb317-6"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb317-6"></a>       <span class="dt">length =</span> <span class="fl">0.08</span>,</span>
<span id="cb317-7"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb317-7"></a>       <span class="dt">lwd =</span> <span class="fl">0.8</span>)</span></code></pre></div>
<p>Whereas <code>text()</code> takes a single set of coordinates, <code>arrows()</code> takes two: the x- and y-coordinates to draw the arrow <em>from</em>, <code>x0 =</code> and <code>y0 =</code> and then the coordinates to draw it <em>to</em>, <code>x1 =</code> and <code>y1 =</code>. These are all reasonably straightforward if you recall that we need to use <code>ymd()</code> to convert text into date format, with the exception of the final one. What we’re doing with that bit of subscripting is extracting the value for the search intensity for that date, and then we’re adding 5 to it. This is because we want our arrow to extend down the plot and finish a little bit above the actual data point that we wish to indicate.</p>
<p>There are then two further arguments, <code>length = 0.08</code>, which does not have any effect on the length of the line — rather, it alters the length of the shorter lines that make up the arrowhead. The default value is 0.25 which gives a rather big arrowhead. We want a smaller one so we’ll use a smaller value. Finally we want the line to be drawn rather thin so that it’s not as intrusive, and we use the <code>lwd = 0.8</code> argument to do this.</p>
<p>So far so good, but what if we want to indicate the other match dates on our graph as well? Do we need separate lines of code with <code>text()</code> and <code>arrows()</code> for each date? Fortunately not: both of these functions will draw multiple instances of text or arrows if we ask nicely. For <code>text()</code> we replace the single x- and y-coordinates with two vectors of coordinates, and the character data given for the text with a vector of character data. Similarly, for <code>arrows()</code> we use a vector of coordinates for each of <code>x0</code>, <code>y0</code>, <code>x1</code> and <code>y1</code>. Let’s have a go.</p>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb318-1"></a><span class="co"># Vector of x-coordinates</span></span>
<span id="cb318-2"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb318-2"></a>match_dates &lt;-<span class="st"> </span><span class="kw">ymd</span>(<span class="kw">c</span>(<span class="st">&quot;2019-09-06&quot;</span>, <span class="st">&quot;2019-09-21&quot;</span>, </span>
<span id="cb318-3"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb318-3"></a>                     <span class="st">&quot;2019-09-28&quot;</span>, <span class="st">&quot;2019-10-04&quot;</span>, </span>
<span id="cb318-4"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb318-4"></a>                     <span class="st">&quot;2019-10-08&quot;</span>, <span class="st">&quot;2019-10-20&quot;</span>, </span>
<span id="cb318-5"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb318-5"></a>                     <span class="st">&quot;2019-10-27&quot;</span>, <span class="st">&quot;2019-11-02&quot;</span>))</span>
<span id="cb318-6"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb318-6"></a></span>
<span id="cb318-7"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb318-7"></a><span class="co"># Vector of y-coordinates for text</span></span>
<span id="cb318-8"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb318-8"></a>text_y &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">115</span>, <span class="dt">times =</span> <span class="dv">8</span>)</span>
<span id="cb318-9"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb318-9"></a></span>
<span id="cb318-10"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb318-10"></a><span class="co"># Vector of matches</span></span>
<span id="cb318-11"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb318-11"></a>matches &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Japan</span><span class="ch">\n</span><span class="st">Warm up&quot;</span>, <span class="st">&quot;New</span><span class="ch">\n</span><span class="st">Zealand&quot;</span>, </span>
<span id="cb318-12"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb318-12"></a>             <span class="st">&quot;Namibia&quot;</span>, <span class="st">&quot;Italy&quot;</span>,</span>
<span id="cb318-13"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb318-13"></a>             <span class="st">&quot;Canada&quot;</span>, <span class="st">&quot;Japan&quot;</span>,</span>
<span id="cb318-14"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb318-14"></a>             <span class="st">&quot;Wales&quot;</span>, <span class="st">&quot;England</span><span class="ch">\n</span><span class="st">Final&quot;</span>)</span>
<span id="cb318-15"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb318-15"></a>             </span>
<span id="cb318-16"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb318-16"></a><span class="co"># Vector of upper x-coordinates for arrows</span></span>
<span id="cb318-17"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb318-17"></a>arrows_y0 &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">108</span>, <span class="dt">times =</span> <span class="dv">8</span>)</span>
<span id="cb318-18"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb318-18"></a></span>
<span id="cb318-19"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb318-19"></a><span class="co"># Vector of lower x-coordindates for arrows</span></span>
<span id="cb318-20"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb318-20"></a>arrows_y1 &lt;-<span class="st"> </span>rugby<span class="op">$</span>Searches[<span class="kw">which</span>(rugby<span class="op">$</span>Date <span class="op">%in%</span><span class="st"> </span>match_dates <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>)] <span class="op">+</span><span class="dv">3</span></span></code></pre></div>
<p>This has set up all of the data vectors we need to add our text and arrows. Some things are fairly obvious, so we’re using <code>ymd()</code> from the lubridate package to convert character data into dates again, we’re using the <code>rep()</code> function when we just need a vector with multiple elements which are the same and inn the <code>matches</code> vector we’re using the <code>\n</code> character when we want a new line for a particular piece of text. The code for the subscripts for the vector of lower x-coordinates for arrows is not, however, immediately clear. We’re using an operator which you might not have seen before, <code>%in%</code>. This matches one object against another, so here it will return <code>TRUE</code> if an element of the <code>rugby$Date</code> vector is also present in the <code>match_dates</code> vector, and <code>FALSE</code> otherwise. Feeding that into the <code>which()</code> function and asking which values are <code>TRUE</code> gives me the indices for the values in <code>rugby$Searches</code> which correspond to the match days, and then I can extract those values using a subscript and add 5 to each of them.</p>
<p>Just to show how that works let’s run through it in pieces.</p>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb319-1"></a><span class="co"># Just using the match operator returns a vector of TRUE and FALSE depending on whether the corresponding value of rugby$Date is also presnet in match_dates or not</span></span>
<span id="cb319-2"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb319-2"></a>rugby<span class="op">$</span>Date <span class="op">%in%</span><span class="st"> </span>match_dates</span>
<span id="cb319-3"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb319-3"></a> [<span class="dv">1</span>] <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span>  <span class="ot">TRUE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span></span>
<span id="cb319-4"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb319-4"></a>[<span class="dv">13</span>] <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span>  <span class="ot">TRUE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span></span>
<span id="cb319-5"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb319-5"></a>[<span class="dv">25</span>] <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span>  <span class="ot">TRUE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span>  <span class="ot">TRUE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span></span>
<span id="cb319-6"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb319-6"></a>[<span class="dv">37</span>] <span class="ot">FALSE</span>  <span class="ot">TRUE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span></span>
<span id="cb319-7"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb319-7"></a>[<span class="dv">49</span>] <span class="ot">FALSE</span>  <span class="ot">TRUE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span>  <span class="ot">TRUE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span></span>
<span id="cb319-8"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb319-8"></a>[<span class="dv">61</span>] <span class="ot">FALSE</span> <span class="ot">FALSE</span>  <span class="ot">TRUE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span></span>
<span id="cb319-9"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb319-9"></a>[<span class="dv">73</span>] <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span></span>
<span id="cb319-10"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb319-10"></a>[<span class="dv">85</span>] <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span></span></code></pre></div>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb320-1"></a><span class="co"># Which of these elements are TRUE?</span></span>
<span id="cb320-2"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb320-2"></a><span class="kw">which</span>(rugby<span class="op">$</span>Date <span class="op">%in%</span><span class="st"> </span>match_dates <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>)</span>
<span id="cb320-3"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb320-3"></a>[<span class="dv">1</span>]  <span class="dv">6</span> <span class="dv">21</span> <span class="dv">28</span> <span class="dv">34</span> <span class="dv">38</span> <span class="dv">50</span> <span class="dv">57</span> <span class="dv">63</span></span></code></pre></div>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb321-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb321-1"></a><span class="co"># Use these as a vector of subscripts to extract the desired data from rugby$Searches and add 5 to each value</span></span>
<span id="cb321-2"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb321-2"></a>rugby<span class="op">$</span>Searches[<span class="kw">which</span>(rugby<span class="op">$</span>Date <span class="op">%in%</span><span class="st"> </span>match_dates <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>)] <span class="op">+</span><span class="dv">5</span></span>
<span id="cb321-3"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb321-3"></a>[<span class="dv">1</span>]  <span class="dv">29</span>  <span class="dv">61</span>  <span class="dv">36</span>  <span class="dv">46</span>  <span class="dv">38</span>  <span class="dv">71</span>  <span class="dv">84</span> <span class="dv">105</span></span></code></pre></div>
<p>Now let’s draw our final plot.</p>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb322-1"></a><span class="co"># Plot graph</span></span>
<span id="cb322-2"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb322-2"></a><span class="kw">plot</span>(rugby<span class="op">$</span>Searches <span class="op">~</span><span class="st"> </span>rugby<span class="op">$</span>Date, </span>
<span id="cb322-3"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb322-3"></a>     <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, </span>
<span id="cb322-4"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb322-4"></a>     <span class="dt">col =</span> <span class="st">&quot;steelblue&quot;</span>, </span>
<span id="cb322-5"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb322-5"></a>     <span class="dt">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb322-6"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb322-6"></a>     <span class="dt">xlab =</span> <span class="st">&quot;Date&quot;</span>,</span>
<span id="cb322-7"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb322-7"></a>     <span class="dt">ylab =</span> <span class="st">&quot;Search intensity on Google&quot;</span>,</span>
<span id="cb322-8"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb322-8"></a>     <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">120</span>))</span>
<span id="cb322-9"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb322-9"></a></span>
<span id="cb322-10"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb322-10"></a><span class="co"># Add text</span></span>
<span id="cb322-11"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb322-11"></a><span class="kw">text</span>(<span class="dt">x =</span> match_dates, </span>
<span id="cb322-12"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb322-12"></a>     <span class="dt">y =</span> text_y,</span>
<span id="cb322-13"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb322-13"></a>     <span class="dt">labels =</span> matches, </span>
<span id="cb322-14"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb322-14"></a>     <span class="dt">cex =</span> <span class="fl">0.6</span>)</span>
<span id="cb322-15"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb322-15"></a></span>
<span id="cb322-16"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb322-16"></a><span class="co"># Add arrow</span></span>
<span id="cb322-17"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb322-17"></a><span class="kw">arrows</span>(<span class="dt">x0 =</span> match_dates, </span>
<span id="cb322-18"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb322-18"></a>       <span class="dt">y0 =</span> arrows_y0, </span>
<span id="cb322-19"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb322-19"></a>       <span class="dt">x1 =</span> match_dates, </span>
<span id="cb322-20"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb322-20"></a>       <span class="dt">y1 =</span> arrows_y1,</span>
<span id="cb322-21"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb322-21"></a>       <span class="dt">length =</span> <span class="fl">0.05</span>,</span>
<span id="cb322-22"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb322-22"></a>       <span class="dt">lwd =</span> <span class="fl">0.8</span>)</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-315"></span>
<img src="3rd_Edition_files/figure-html/unnamed-chunk-315-1.png" alt="Google searches for &quot;Springboks&quot; in South Africa from September to the beginning of December 2019. Match dates and opponents for the South African rugby team are indicated" width="672" />
<p class="caption">
Figure 10.15: Google searches for “Springboks” in South Africa from September to the beginning of December 2019. Match dates and opponents for the South African rugby team are indicated
</p>
</div>
</div>
<div id="confidence-bands-for-fitted-lines" class="section level2">
<h2><span class="header-section-number">10.6</span> Confidence bands for fitted lines</h2>
<div id="adding-confidence-bands-using-lines" class="section level3">
<h3><span class="header-section-number">10.6.1</span> Adding confidence bands using <code>lines()</code></h3>
<p><strong>Warning</strong> This bit gets a bit advanced in places and is maybe not for the faint of heart. If you aren’t familiar with concepts like confidence intervals you might want to skip this, and the next, section. Alternatively, maybe read through it but don’t worry if some of it’s tending towards the incomprehensible.</p>
<p>When we fit a line to a set of data we’re generating an estimate of where the most likely values for our y-variable are given any value of the x-variable. In a world where sample sizes are often much smaller than we’d wish, we often have limited confidence in how accurate our estimation is. For this reason we often display fitted lines with an indication of how confident we are in their location, usually by showing the <em>95% confidence intervals</em>. How can we add these to our plot of pinniped brain sizes (yes, after that excursion into Google searches for Southern Hemisphere rugby teams we’re back on the seals I’m afraid)? The first thing to do is to work out what these confidence intervals are. To do this we need to use the <code>predict()</code> function, which generates predicted values from a statistical model. <code>predict()</code> has an argument <code>se.fit =</code> and if we set this to TRUE it will calculate a <em>standard error</em> for each predicted point, and we can then use this to generate our 95% confidence intervals.</p>
<p>Let’s go back to our pinniped data. We have already fitted two statistical models, each giving us a fitted straight line relating log brain size to log body mass for males, one for harem and one for non-harem breeders. To generate our predicted values and standard errors we’ll need to produce some dummy data for our prediction and the use <code>predict()</code> on that.</p>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb323-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb323-1"></a><span class="co"># Generate dummy variable for harem breeders</span></span>
<span id="cb323-2"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb323-2"></a>harem_x_seq &lt;-</span>
<span id="cb323-3"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb323-3"></a><span class="st">  </span><span class="kw">seq</span>(</span>
<span id="cb323-4"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb323-4"></a>    <span class="dt">from =</span> <span class="kw">min</span>(pinniped<span class="op">$</span>Male_mass[Mating_system <span class="op">==</span><span class="st"> &quot;Harem&quot;</span>]),</span>
<span id="cb323-5"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb323-5"></a>    <span class="dt">to =</span> <span class="kw">max</span>(pinniped<span class="op">$</span>Male_mass[Mating_system <span class="op">==</span><span class="st"> &quot;Harem&quot;</span>]),</span>
<span id="cb323-6"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb323-6"></a>    <span class="dt">length =</span> <span class="dv">100</span></span>
<span id="cb323-7"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb323-7"></a>  )</span>
<span id="cb323-8"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb323-8"></a></span>
<span id="cb323-9"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb323-9"></a><span class="co">#Generate dummy variable for non-harem breeders</span></span>
<span id="cb323-10"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb323-10"></a>non_harem_x_seq &lt;-</span>
<span id="cb323-11"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb323-11"></a><span class="st">  </span><span class="kw">seq</span>(</span>
<span id="cb323-12"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb323-12"></a>    <span class="dt">from =</span> <span class="kw">min</span>(pinniped<span class="op">$</span>Male_mass[Mating_system <span class="op">==</span><span class="st"> &quot;Non harem&quot;</span>]),</span>
<span id="cb323-13"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb323-13"></a>    <span class="dt">to =</span> <span class="kw">max</span>(pinniped<span class="op">$</span>Male_mass[Mating_system <span class="op">==</span><span class="st"> &quot;Non harem&quot;</span>]),</span>
<span id="cb323-14"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb323-14"></a>    <span class="dt">length =</span> <span class="dv">100</span></span>
<span id="cb323-15"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb323-15"></a>  )</span>
<span id="cb323-16"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb323-16"></a></span>
<span id="cb323-17"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb323-17"></a><span class="co">#Generate predicted values and SEs for harem breeders</span></span>
<span id="cb323-18"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb323-18"></a>pred_harem &lt;-</span>
<span id="cb323-19"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb323-19"></a><span class="st">  </span><span class="kw">predict</span>(harem_mod,</span>
<span id="cb323-20"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb323-20"></a>          <span class="dt">newdata =</span> <span class="kw">data.frame</span>(<span class="dt">Male_mass =</span> harem_x_seq),</span>
<span id="cb323-21"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb323-21"></a>          <span class="dt">se.fit =</span> <span class="ot">TRUE</span>)</span>
<span id="cb323-22"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb323-22"></a>pred_harem &lt;-</span>
<span id="cb323-23"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb323-23"></a><span class="st">  </span><span class="kw">predict</span>(harem_mod,</span>
<span id="cb323-24"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb323-24"></a>          <span class="dt">newdata =</span> <span class="kw">data.frame</span>(<span class="dt">Male_mass =</span> harem_x_seq),</span>
<span id="cb323-25"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb323-25"></a>          <span class="dt">se.fit =</span> <span class="ot">TRUE</span>)</span>
<span id="cb323-26"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb323-26"></a></span>
<span id="cb323-27"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb323-27"></a><span class="co">#Generate predicted values and SEs for non-harem breeders</span></span>
<span id="cb323-28"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb323-28"></a>pred_non_harem &lt;-</span>
<span id="cb323-29"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb323-29"></a><span class="st">  </span><span class="kw">predict</span>(non_harem_mod,</span>
<span id="cb323-30"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb323-30"></a>          <span class="dt">newdata =</span> <span class="kw">data.frame</span>(<span class="dt">Male_mass =</span> non_harem_x_seq),</span>
<span id="cb323-31"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb323-31"></a>          <span class="dt">se.fit =</span> <span class="ot">TRUE</span>)</span>
<span id="cb323-32"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb323-32"></a></span>
<span id="cb323-33"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb323-33"></a><span class="co">#Structure of pred_harem</span></span>
<span id="cb323-34"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb323-34"></a><span class="kw">str</span>(pred_harem)</span>
<span id="cb323-35"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb323-35"></a>List of <span class="dv">4</span></span>
<span id="cb323-36"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb323-36"></a> <span class="op">$</span><span class="st"> </span>fit           <span class="op">:</span><span class="st"> </span>Named num [<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>] <span class="fl">5.58</span> <span class="fl">5.74</span> <span class="fl">5.86</span> <span class="fl">5.94</span> <span class="fl">6.01</span> ...</span>
<span id="cb323-37"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb323-37"></a>  ..<span class="op">-</span><span class="st"> </span><span class="kw">attr</span>(<span class="op">*</span>, <span class="st">&quot;names&quot;</span>)=<span class="st"> </span>chr [<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>] <span class="st">&quot;1&quot;</span> <span class="st">&quot;2&quot;</span> <span class="st">&quot;3&quot;</span> <span class="st">&quot;4&quot;</span> ...</span>
<span id="cb323-38"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb323-38"></a> <span class="op">$</span><span class="st"> </span>se.fit        <span class="op">:</span><span class="st"> </span>Named num [<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>] <span class="fl">0.0826</span> <span class="fl">0.0679</span> <span class="fl">0.059</span> <span class="fl">0.0534</span> <span class="fl">0.0499</span> ...</span>
<span id="cb323-39"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb323-39"></a>  ..<span class="op">-</span><span class="st"> </span><span class="kw">attr</span>(<span class="op">*</span>, <span class="st">&quot;names&quot;</span>)=<span class="st"> </span>chr [<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>] <span class="st">&quot;1&quot;</span> <span class="st">&quot;2&quot;</span> <span class="st">&quot;3&quot;</span> <span class="st">&quot;4&quot;</span> ...</span>
<span id="cb323-40"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb323-40"></a> <span class="op">$</span><span class="st"> </span>df            <span class="op">:</span><span class="st"> </span>int <span class="dv">16</span></span>
<span id="cb323-41"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb323-41"></a> <span class="op">$</span><span class="st"> </span>residual.scale<span class="op">:</span><span class="st"> </span>num <span class="fl">0.197</span></span></code></pre></div>
<p>Here, what I’ve done is to use the <code>seq()</code> function to generate two sequences of data each with 100 evenly spaced values, using the minimum and maximum body mass values for harem breeding and non-harem breeding males. I’ve used the untransformed data rather than the log-transformed minima and maxima that we used in the previous section here because that’s what we used in the original linear model: we did the log transformation <em>within</em> the model formula so we need to give <code>predict()</code> the untransformed data. I’ve then fed these sequences into the <code>predict()</code> function, with the appropriate fitted model specified for each. The data that we want to predict from are specified by the <code>newdata =</code> argument in <code>predict()</code>, but it will only work if we use a variable with the same name (or names for a more complex model) as the name of the explanatory variable in the original model. I don’t want to start generating variables in the workspace with the name <code>Male_mass</code> because it’s the same as the name in my data frame, and I would also need to generate one, use it for the prediction, delete it or change its name and then generate the next. Hence I’ve used the <code>data.frame()</code> function inside the <code>predict()</code> function call to generate a temporary data frame with one variable named <code>Male_mass</code>.</p>
<p>As we can see from the <code>str(pred_harem)</code> output, the object we’ve generated using <code>predict()</code> is a list with four components. Of these three are important to us: <code>$fit</code> which is the predicted fitted values — these will correspond to the values of the lines we’ve already plotted; <code>$se.fit</code> which are the standard errors for these fitted values, and <code>$df</code> which is the number of degrees of freedom. These are important because we need all three of them to calculate the 95% confidence intervals.</p>
<p>For any estimate we need an upper and a lower confidence interval. The upper and lower confidence intervals are calculated as:</p>
<p><span class="math display">\[ \mathrm{Upper \: CI} = \mathrm{Fitted \: value} + SE \times t_{df} \]</span>
<span class="math display">\[ \mathrm{Lower \: CI} = \mathrm{Fitted \: value} - SE \times t_{df} \]</span>
where <span class="math inline">\(t_{df}\)</span> is the critical value of the <em>t-distribution</em> at the appropriate number of degrees of freedom. If all of this sounds like total gibberish to you, don’t worry: it’s just some arithmetic we need to do to generate our confidence intervals.</p>
<p>How do we generate the critical values of <em>t</em>? There’s a function called <code>qt()</code> which will give us the <em>quantiles</em> of the t-distributoin and we can feed this the appropriate probability and degrees of freedom. For our harem breeders, therefore, we can calculate our upper and lower confidence values as:</p>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb324-1"></a></span>
<span id="cb324-2"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb324-2"></a><span class="co">#Upper CI</span></span>
<span id="cb324-3"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb324-3"></a>harem_upper_CI &lt;-<span class="st"> </span>pred_harem<span class="op">$</span>fit <span class="op">+</span><span class="st"> </span>pred_harem<span class="op">$</span>se.fit <span class="op">*</span><span class="st"> </span><span class="kw">qt</span>(<span class="dt">p =</span> <span class="fl">0.975</span>, <span class="dt">df =</span> pred_harem<span class="op">$</span>df)</span>
<span id="cb324-4"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb324-4"></a></span>
<span id="cb324-5"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb324-5"></a><span class="co">#Lower CI</span></span>
<span id="cb324-6"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb324-6"></a>harem_lower_CI &lt;-<span class="st"> </span>pred_harem<span class="op">$</span>fit <span class="op">-</span><span class="st"> </span>pred_harem<span class="op">$</span>se.fit <span class="op">*</span><span class="st"> </span><span class="kw">qt</span>(<span class="dt">p =</span> <span class="fl">0.975</span>, <span class="dt">df =</span> pred_harem<span class="op">$</span>df)</span></code></pre></div>
<p>This is all relatively straightforward aside from the <code>qt(0.975, df = pred_harem$df)</code> bit which is a little obscure. The <code>df = pred_harem$df</code> argument is giving it the degrees of freedom from the output of <code>predict()</code>, but what about <code>p = 0.975</code>? This is telling it the probability that we’re thinking about for our confidence intervals, but instead of <code>p = 0.95</code> we have to use <code>p = 0.975</code> because the t-distribution is a <em>two-tailed</em> distribution so we need to think about the upper tail as well as the lower tail. If you’re not very clear on your statistical theory yet this will, I realise, make no sense whatsoever… just take it at face value and if you want go and look up the difference between one-tailed and two-tailed tests.</p>
<p>Let’s generate our confidence intervals for the non-harem breeders as well.</p>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb325-1"></a></span>
<span id="cb325-2"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb325-2"></a><span class="co">#Upper CI</span></span>
<span id="cb325-3"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb325-3"></a>non_harem_upper_CI &lt;-</span>
<span id="cb325-4"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb325-4"></a><span class="st">  </span>pred_non_harem<span class="op">$</span>fit <span class="op">+</span><span class="st"> </span>pred_non_harem<span class="op">$</span>se.fit <span class="op">*</span><span class="st"> </span><span class="kw">qt</span>(<span class="dt">p =</span> <span class="fl">0.975</span>, </span>
<span id="cb325-5"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb325-5"></a>  <span class="dt">df =</span> pred_harem<span class="op">$</span>df)</span>
<span id="cb325-6"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb325-6"></a></span>
<span id="cb325-7"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb325-7"></a><span class="co">#Lower CI</span></span>
<span id="cb325-8"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb325-8"></a>non_harem_lower_CI &lt;-</span>
<span id="cb325-9"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb325-9"></a><span class="st">  </span>pred_non_harem<span class="op">$</span>fit <span class="op">-</span><span class="st"> </span>pred_non_harem<span class="op">$</span>se.fit <span class="op">*</span><span class="st"> </span><span class="kw">qt</span>(<span class="dt">p =</span> <span class="fl">0.975</span>, </span>
<span id="cb325-10"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb325-10"></a>  <span class="dt">df =</span> pred_harem<span class="op">$</span>df)</span></code></pre></div>
<p>OK. We now have, for each group of male pinnipeds:</p>
<ul>
<li>A sequence of dummy x-values, 100 numbers long, running from the lowest to the highest value for each group</li>
<li>A set of fitted values, one for each of our dummy x-values, corresponding to where our fitted line would be</li>
<li>A set of values, one for each of our 100 dummy x-values, with the calculated upper 95% confidence limit for the fitted value</li>
<li>A set of values as above, but with the calculated lower 95% confidence limits.</li>
</ul>
<p>Let’s use these to indicate the confidence intervals on our graph. We can do this using <code>lines()</code> if we just want a line to show our confidence intervals, or if you wish to be <strong>fashionable</strong> we can indicate them with a shaded area using <code>polygon()</code>. It’s easiest with <code>lines()</code> so let’s do that: we’re doing exactly what we did in the last section by giving the <code>lines()</code> function a series of points to link together, and because we’re using lots of them what gets drawn will look like a curve.</p>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-1"></a></span>
<span id="cb326-2"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-2"></a></span>
<span id="cb326-3"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-3"></a><span class="co"># Plot the data</span></span>
<span id="cb326-4"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-4"></a><span class="kw">plot</span>(</span>
<span id="cb326-5"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-5"></a>  <span class="kw">log</span>(pinniped<span class="op">$</span>Male_brain) <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(pinniped<span class="op">$</span>Male_mass),</span>
<span id="cb326-6"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-6"></a>  <span class="dt">xlab =</span> <span class="st">&quot;Log body mass (Kg)&quot;</span>,</span>
<span id="cb326-7"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-7"></a>  <span class="dt">ylab =</span> <span class="st">&quot;Log brain mass (g)&quot;</span>,</span>
<span id="cb326-8"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-8"></a>  <span class="dt">pch =</span> <span class="dv">16</span>,</span>
<span id="cb326-9"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-9"></a>  <span class="dt">col =</span> colours[Mating_system]</span>
<span id="cb326-10"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-10"></a>)</span>
<span id="cb326-11"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-11"></a></span>
<span id="cb326-12"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-12"></a><span class="co"># Add regression line for harem breeders</span></span>
<span id="cb326-13"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-13"></a><span class="kw">lines</span>(</span>
<span id="cb326-14"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-14"></a>  <span class="dt">x =</span> <span class="kw">log</span>(harem_x_seq),</span>
<span id="cb326-15"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-15"></a>  <span class="dt">y =</span> pred_harem<span class="op">$</span>fit,</span>
<span id="cb326-16"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-16"></a>  <span class="dt">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb326-17"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-17"></a>  <span class="dt">col =</span> colours[<span class="dv">1</span>]</span>
<span id="cb326-18"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-18"></a>)</span>
<span id="cb326-19"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-19"></a></span>
<span id="cb326-20"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-20"></a><span class="co"># Add upper 95% CI line</span></span>
<span id="cb326-21"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-21"></a><span class="kw">lines</span>(</span>
<span id="cb326-22"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-22"></a>  <span class="dt">x =</span> <span class="kw">log</span>(harem_x_seq),</span>
<span id="cb326-23"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-23"></a>  <span class="dt">y =</span> harem_upper_CI,</span>
<span id="cb326-24"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-24"></a>  <span class="dt">lwd =</span> <span class="fl">0.8</span>,</span>
<span id="cb326-25"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-25"></a>  <span class="dt">col =</span> colours[<span class="dv">1</span>]</span>
<span id="cb326-26"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-26"></a>)</span>
<span id="cb326-27"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-27"></a></span>
<span id="cb326-28"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-28"></a><span class="co"># Add lower 95% CI line</span></span>
<span id="cb326-29"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-29"></a><span class="kw">lines</span>(</span>
<span id="cb326-30"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-30"></a>  <span class="dt">x =</span> <span class="kw">log</span>(harem_x_seq),</span>
<span id="cb326-31"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-31"></a>  <span class="dt">y =</span> harem_lower_CI,</span>
<span id="cb326-32"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-32"></a>  <span class="dt">lwd =</span> <span class="fl">0.8</span>,</span>
<span id="cb326-33"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-33"></a>  <span class="dt">col =</span> colours[<span class="dv">1</span>]</span>
<span id="cb326-34"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-34"></a>)</span>
<span id="cb326-35"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-35"></a></span>
<span id="cb326-36"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-36"></a></span>
<span id="cb326-37"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-37"></a><span class="co"># Add regression line for non-harem breeders</span></span>
<span id="cb326-38"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-38"></a><span class="kw">lines</span>(</span>
<span id="cb326-39"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-39"></a>  <span class="dt">x =</span> <span class="kw">log</span>(non_harem_x_seq),</span>
<span id="cb326-40"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-40"></a>  <span class="dt">y =</span> pred_non_harem<span class="op">$</span>fit,</span>
<span id="cb326-41"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-41"></a>  <span class="dt">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb326-42"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-42"></a>  <span class="dt">col =</span> colours[<span class="dv">2</span>]</span>
<span id="cb326-43"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-43"></a>)</span>
<span id="cb326-44"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-44"></a></span>
<span id="cb326-45"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-45"></a><span class="co"># Add upper 95% CI line</span></span>
<span id="cb326-46"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-46"></a><span class="kw">lines</span>(</span>
<span id="cb326-47"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-47"></a>  <span class="dt">x =</span> <span class="kw">log</span>(non_harem_x_seq),</span>
<span id="cb326-48"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-48"></a>  <span class="dt">y =</span> non_harem_upper_CI,</span>
<span id="cb326-49"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-49"></a>  <span class="dt">lwd =</span> <span class="fl">0.8</span>,</span>
<span id="cb326-50"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-50"></a>  <span class="dt">col =</span> colours[<span class="dv">2</span>]</span>
<span id="cb326-51"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-51"></a>)</span>
<span id="cb326-52"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-52"></a></span>
<span id="cb326-53"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-53"></a><span class="co"># Add lower 95% CI line</span></span>
<span id="cb326-54"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-54"></a><span class="kw">lines</span>(</span>
<span id="cb326-55"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-55"></a>  <span class="dt">x =</span> <span class="kw">log</span>(non_harem_x_seq),</span>
<span id="cb326-56"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-56"></a>  <span class="dt">y =</span> non_harem_lower_CI,</span>
<span id="cb326-57"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-57"></a>  <span class="dt">lwd =</span> <span class="fl">0.8</span>,</span>
<span id="cb326-58"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-58"></a>  <span class="dt">col =</span> colours[<span class="dv">2</span>]</span>
<span id="cb326-59"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb326-59"></a>)</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-319"></span>
<img src="3rd_Edition_files/figure-html/unnamed-chunk-319-1.png" alt="Brain mass versus body mass for 33 species of male pinniped plotted on log scaled axes, colour coded for mating system" width="672" />
<p class="caption">
Figure 10.16: Brain mass versus body mass for 33 species of male pinniped plotted on log scaled axes, colour coded for mating system
</p>
</div>
<p>There we have it. A few things to point out are firstly that I’ve drawn the 95% confidence intervals in using much thinner lines than the fitted straight lines to make it clear which is which. You could equally well use dashed or dotted lines to achieve the same effect. Secondly, I had to log transform the dummy x-values for the plot because, as you might remember, we needed the untransformed data to feed into <code>predict()</code> because the log transformation was done within the <code>lm()</code> function call. This whole business of what to log and when has made this all rather complicated, but this is the sort of issue that you have to cope with when you’re dealing with real data.<a href="#fn13" class="footnote-ref" id="fnref13"><sup>13</sup></a></p>
</div>
<div id="adding-confidence-intervals-to-fitted-lines-using-polygon" class="section level3">
<h3><span class="header-section-number">10.6.2</span> Adding confidence intervals to fitted lines using <code>polygon()</code></h3>
<p><code>polygon()</code> is, as you might expect, a function that will draw a shape onto a plot. It takes a vector of x-coordinates and a vector of y-coordinates, and draws the shape defined by the series of xy values defined by those two vectors. Here’s a simple example: we’ll plot a graph with no data and then draw in a square using <code>polygon()</code>. To make a specific point I’ll add the coordinates of each of the corners (“vertices”) using <code>text()</code>: more on this in the next section.</p>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb327-1"></a></span>
<span id="cb327-2"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb327-2"></a><span class="co"># Plot empty graph</span></span>
<span id="cb327-3"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb327-3"></a><span class="kw">plot</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, </span>
<span id="cb327-4"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb327-4"></a>     <span class="dt">type =</span> <span class="st">&quot;n&quot;</span>, </span>
<span id="cb327-5"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb327-5"></a>     <span class="dt">xlab =</span> <span class="st">&quot;&quot;</span>, </span>
<span id="cb327-6"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb327-6"></a>     <span class="dt">ylab =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb327-7"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb327-7"></a></span>
<span id="cb327-8"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb327-8"></a><span class="co"># Add polygon</span></span>
<span id="cb327-9"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb327-9"></a><span class="kw">polygon</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">2</span>), </span>
<span id="cb327-10"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb327-10"></a>        <span class="dt">y =</span> <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">3</span>),</span>
<span id="cb327-11"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb327-11"></a>        <span class="dt">col =</span> <span class="st">&quot;aquamarine4&quot;</span>)</span>
<span id="cb327-12"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb327-12"></a></span>
<span id="cb327-13"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb327-13"></a><span class="co"># Add coordinates to the bottom of the square</span></span>
<span id="cb327-14"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb327-14"></a><span class="kw">text</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="fl">1.9</span>,<span class="fl">3.1</span>), </span>
<span id="cb327-15"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb327-15"></a>        <span class="dt">y =</span> <span class="kw">c</span>(<span class="fl">1.9</span>,<span class="fl">1.9</span>), </span>
<span id="cb327-16"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb327-16"></a>        <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;2,2&quot;</span>, <span class="st">&quot;3,2&quot;</span>))</span>
<span id="cb327-17"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb327-17"></a></span>
<span id="cb327-18"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb327-18"></a><span class="co"># Add coordinates to the top of the square</span></span>
<span id="cb327-19"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb327-19"></a><span class="kw">text</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="fl">3.1</span>,<span class="fl">1.9</span>), </span>
<span id="cb327-20"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb327-20"></a>        <span class="dt">y =</span> <span class="kw">c</span>(<span class="fl">3.1</span>,<span class="fl">3.1</span>), </span>
<span id="cb327-21"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb327-21"></a>        <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;3,3&quot;</span>, <span class="st">&quot;2,3&quot;</span>))</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-320"></span>
<img src="3rd_Edition_files/figure-html/unnamed-chunk-320-1.png" alt="Example of drawing a simple polygon" width="672" />
<p class="caption">
Figure 10.17: Example of drawing a simple polygon
</p>
</div>
<p>This is likely to look more lke a rectangle, but in terms of the scales on the x-and y-axes this is a square. We’ve filled it with the <code>aquamarine4</code> colour using the <code>col =</code> argument just to stop it being so dreary.</p>
<p>The important thing to notice here is that we need to think about the order in which our x- and y- coordinates are given to <code>polygon()</code> because it joins them together in order. Here I’ve started with the bottom left vertex and then gone bottom right, top right and then back to the top left: if you take the first, second, third and fourth x-values and y-values form the function call and put them together you get 2,2 3,2 3,3 and 3,2. You don’t need to go all the way back to the starting point because <code>polygon()</code> will just link up the first vertex with the last. What happens if we put the x- and y-values in a different order?</p>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb328-1"></a></span>
<span id="cb328-2"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb328-2"></a><span class="co"># Plot empty graph</span></span>
<span id="cb328-3"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb328-3"></a><span class="kw">plot</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, </span>
<span id="cb328-4"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb328-4"></a>     <span class="dt">type =</span> <span class="st">&quot;n&quot;</span>, </span>
<span id="cb328-5"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb328-5"></a>     <span class="dt">xlab =</span> <span class="st">&quot;&quot;</span>, </span>
<span id="cb328-6"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb328-6"></a>     <span class="dt">ylab =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb328-7"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb328-7"></a></span>
<span id="cb328-8"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb328-8"></a><span class="co"># Add polygon</span></span>
<span id="cb328-9"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb328-9"></a><span class="kw">polygon</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">2</span>), </span>
<span id="cb328-10"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb328-10"></a>        <span class="dt">y =</span> <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">3</span>),</span>
<span id="cb328-11"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb328-11"></a>        <span class="dt">col =</span> <span class="st">&quot;aquamarine4&quot;</span>)</span>
<span id="cb328-12"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb328-12"></a></span>
<span id="cb328-13"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb328-13"></a><span class="co"># Add coordinates to the bottom of the square</span></span>
<span id="cb328-14"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb328-14"></a><span class="kw">text</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="fl">1.9</span>,<span class="fl">3.1</span>), </span>
<span id="cb328-15"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb328-15"></a>        <span class="dt">y =</span> <span class="kw">c</span>(<span class="fl">1.9</span>,<span class="fl">1.9</span>), </span>
<span id="cb328-16"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb328-16"></a>        <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;2,2&quot;</span>, <span class="st">&quot;3,2&quot;</span>))</span>
<span id="cb328-17"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb328-17"></a></span>
<span id="cb328-18"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb328-18"></a><span class="co"># Add coordinates to the top of the square</span></span>
<span id="cb328-19"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb328-19"></a><span class="kw">text</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="fl">3.1</span>,<span class="fl">1.9</span>), </span>
<span id="cb328-20"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb328-20"></a>        <span class="dt">y =</span> <span class="kw">c</span>(<span class="fl">3.1</span>,<span class="fl">3.1</span>), </span>
<span id="cb328-21"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb328-21"></a>        <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;3,3&quot;</span>, <span class="st">&quot;2,3&quot;</span>))</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-321"></span>
<img src="3rd_Edition_files/figure-html/unnamed-chunk-321-1.png" alt="Example of drawing a simple polygon" width="672" />
<p class="caption">
Figure 10.18: Example of drawing a simple polygon
</p>
</div>
<p>In this case we can put our <code>x = c(2,3,3,2)</code> and <code>y = c(2,3,2,3)</code> arguments together and we get 2,2 — bottom left, 3,3 — top right, 3,2 — bottom right and 2,3 — top left, so <code>polygon()</code> joins the vertices in that order and we get a different shape. This is important if you want to use <code>polygon()</code> to draw more complicated shapes because you need to think about the order of x- and y-values. When you try to draw something wth <code>polygon()</code> and it comes out messed up, chances are you’ve not got this bit right.</p>
<p>Back to our confidence intervals for the relationship between log brain mass and log body mass in various species of harem- and non-harem breeding pinnipeds, in the last section we calculated a series of x-values and then generated three sets of y-values for each: lower and upper 95% confidence intervals and the fitted values. The latter we can ignore for the present, but we want to use the former two to draw the confidence intervals in as a polygon which we can shade. For this we’ll need x- and y- values for the vertices of the curve that makes up the lower 95% CIs, and then the same for the upper CIs, but <em>in reverse order</em> because we’re going to start in the bottom left hand corner, join up all the vertices for the lower 95% CIs going from left to right, then jump to the furthest right vertex for the upper CIs, and join together all those vertices coming back right-to-left.</p>
<p>Here’s an attempt to illustrate this in a simple way using the 95% CIs for harem breeders only. The arrows indicate the direction in which <code>polygon()</code> “joins the dots”, and I’ve indicated the start point.</p>
<detais><summary>Click here to see the code</summary

```r

# Plot empty graph
plot(log(pinniped$Male_brain) ~ log(pinniped$Male_mass),
     xlab = "Log body mass (Kg)",
     ylab = "Log brain mass (g)", 
     type = "n")

# Add polygon for 95% CIs for harem breeders
polygon(x = c(log(harem_x_seq), rev(log(harem_x_seq))), 
        y = c(harem_lower_CI, rev(harem_upper_CI)))

#Add arrow left to right
arrows(x0 =5, y0 = 5.5,
       x1 = 7.2, y1 = 6.3,
       angle = 20,
       length = 0.2)

# Add arrow right to left
arrows(x0 = 7.2, y0 = 7.1,
       x1 =5, y1 = 6.3,
       angle = 20,
       length = 0.2)

#Add text
text(x = 4.3, y = 5.3, "Start here")

#Add start point
points(x = min(log(harem_x_seq)), 
       y = min(harem_lower_CI), 
       pch = 16)
```

</details>
<div class="figure"><span id="fig:unnamed-chunk-323"></span>
<img src="3rd_Edition_files/figure-html/unnamed-chunk-323-1.png" alt="Drawing a complex polygon illustrated" width="672" />
<p class="caption">
Figure 10.19: Drawing a complex polygon illustrated
</p>
</div>
<p>Here’s that <code>polygon()</code> function call again:</p>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb329-1"></a><span class="kw">polygon</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="kw">log</span>(harem_x_seq), <span class="kw">rev</span>(<span class="kw">log</span>(harem_x_seq))), </span>
<span id="cb329-2"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb329-2"></a>        <span class="dt">y =</span> <span class="kw">c</span>(harem_lower_CI, <span class="kw">rev</span>(harem_upper_CI)))</span></code></pre></div>
<p>We start with <code>x = c(log(harem_x_seq), rev(log(harem_x_seq))),</code>. This constructs the x-values for the whole polygon into a single vector using the <code>c()</code> function. We start with the (log transformed) sequence from the minimum to the maximum values for this set of data: this gives the x-values for all of the vertices on the lower 95% CI. Once we get to the maximum x-value we want <code>polygon()</code> to go up to the highest value of the upper 95% CI, in the top right hand corner, and come all the way back to the lowest value for the upper 95% CI. These have the same x-coordinates as the lower 95% CIs, but we want to put them in in <em>reverse order</em> because we’re coming back across the graph. Hence, we use the <code>rev()</code> function, which reverses things, to add the same values but in reverse order for the second half of our vector of x-values.</p>
<p>Once we get this, the expression for the y-values becomes easier to understand. We want to start with the y-values for the lower 95% CIs in increasing order, then we want the values for the upper 95% CI in reverse order, so we put them together using <code>c(harem_lower_CI, rev(harem_upper_CI))</code>.</p>
<p>Let’s plot our graph properly now.</p>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb330-1"></a></span>
<span id="cb330-2"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb330-2"></a><span class="co"># Plot the data</span></span>
<span id="cb330-3"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb330-3"></a><span class="kw">plot</span>(<span class="kw">log</span>(pinniped<span class="op">$</span>Male_brain) <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(pinniped<span class="op">$</span>Male_mass),</span>
<span id="cb330-4"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb330-4"></a>     <span class="dt">xlab =</span> <span class="st">&quot;Log body mass (Kg)&quot;</span>,</span>
<span id="cb330-5"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb330-5"></a>     <span class="dt">ylab =</span> <span class="st">&quot;Log brain mass (g)&quot;</span>, </span>
<span id="cb330-6"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb330-6"></a>     <span class="dt">pch =</span> <span class="dv">16</span>,</span>
<span id="cb330-7"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb330-7"></a>     <span class="dt">col =</span> colours[Mating_system])</span>
<span id="cb330-8"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb330-8"></a></span>
<span id="cb330-9"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb330-9"></a><span class="co"># Add regression line for harem breeders</span></span>
<span id="cb330-10"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb330-10"></a><span class="kw">lines</span>(<span class="dt">x =</span> <span class="kw">log</span>(harem_x_seq), <span class="dt">y =</span> pred_harem<span class="op">$</span>fit, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span> colours[<span class="dv">1</span>])</span>
<span id="cb330-11"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb330-11"></a></span>
<span id="cb330-12"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb330-12"></a><span class="co"># Add polygon for harem breeders confidence intervals</span></span>
<span id="cb330-13"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb330-13"></a><span class="kw">polygon</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="kw">log</span>(harem_x_seq), <span class="kw">rev</span>(<span class="kw">log</span>(harem_x_seq))), </span>
<span id="cb330-14"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb330-14"></a>        <span class="dt">y =</span> <span class="kw">c</span>(harem_lower_CI, <span class="kw">rev</span>(harem_upper_CI)),</span>
<span id="cb330-15"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb330-15"></a>        <span class="dt">border  =</span> <span class="ot">NA</span>,</span>
<span id="cb330-16"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb330-16"></a>        <span class="dt">col =</span> <span class="kw">adjustcolor</span>(colours[<span class="dv">1</span>], <span class="dt">alpha =</span> <span class="fl">0.5</span>))</span>
<span id="cb330-17"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb330-17"></a></span>
<span id="cb330-18"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb330-18"></a></span>
<span id="cb330-19"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb330-19"></a><span class="co"># Add regression line for non-harem breeders</span></span>
<span id="cb330-20"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb330-20"></a><span class="kw">lines</span>(<span class="dt">x =</span> <span class="kw">log</span>(non_harem_x_seq), <span class="dt">y =</span> pred_non_harem<span class="op">$</span>fit, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span> colours[<span class="dv">2</span>])</span>
<span id="cb330-21"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb330-21"></a></span>
<span id="cb330-22"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb330-22"></a><span class="co"># Add polygon for non-harem breeders confidence intervals</span></span>
<span id="cb330-23"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb330-23"></a><span class="kw">polygon</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="kw">log</span>(non_harem_x_seq), <span class="kw">rev</span>(<span class="kw">log</span>(non_harem_x_seq))), </span>
<span id="cb330-24"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb330-24"></a>        <span class="dt">y =</span> <span class="kw">c</span>(non_harem_lower_CI, <span class="kw">rev</span>(non_harem_upper_CI)),</span>
<span id="cb330-25"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb330-25"></a>        <span class="dt">border  =</span> <span class="ot">NA</span>,</span>
<span id="cb330-26"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb330-26"></a>        <span class="dt">col =</span> <span class="kw">adjustcolor</span>(colours[<span class="dv">2</span>], <span class="dt">alpha =</span> <span class="fl">0.5</span>))</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-325"></span>
<img src="3rd_Edition_files/figure-html/unnamed-chunk-325-1.png" alt="Brain mass versus body mass for 33 species of male pinniped plotted on log scaled axes, colour coded for mating system" width="672" />
<p class="caption">
Figure 10.20: Brain mass versus body mass for 33 species of male pinniped plotted on log scaled axes, colour coded for mating system
</p>
</div>
<p>I’ve added a few arguments to the <code>polygon()</code> function calls to pretty things up. <code>border = NA</code> means that the polygon is drawn without a border. <code>col = adjustcolor(colours[1], alpha = 0.5)</code> sets the colour for the fill of our polygon to be the same as the colour that we’re using for everything else associated with harem breeders. The <code>adjustcolor()</code> function is a function that lets you tweak colours, and in this case I’m using it to make the fill translucent by setting <code>alpha = 0.5</code>. More on this in the section on using transparency.</p>
<p>I mentioned at the start of the previous chapter that there are some things that ggplot2 does rather easier than base graphics… adding shaded polygons as confidence intervals is one of them. In the chapter on ggplot2 we’ll redraw this graph using rather less code than was needed here.</p>
</div>
</div>
<div id="error-bars" class="section level2">
<h2><span class="header-section-number">10.7</span> Error bars</h2>
<div id="adding-error-bars-using-arrows" class="section level3">
<h3><span class="header-section-number">10.7.1</span> Adding error bars using <code>arrows()</code></h3>
<p>Error bars are a simple way of showing how much uncertainty there is in your estimates when when you are dealing with <em>point estimates</em> (means, medians etc.), and you’ve most probably seen many graphs with them in your reading. Error bars are not, however, completely straightforward in R. If you wish to add, say, 95% confidence intervals to a plot of means, you need to calculate what these intervals are and then draw them onto your plot, usually using <code>arrows()</code>. Yes, you read that right, <code>arrows()</code>, the function we met in section 10.5 that draws arrows onto an existing plot. Let’s go back to the World Bank data which we were using to generate boxplots and barplots in the previous chapter.</p>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb331-1"></a></span>
<span id="cb331-2"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb331-2"></a>WB &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;http://www.introductoryr.co.uk/World_bank_data_2014.csv&quot;</span>)</span>
<span id="cb331-3"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb331-3"></a>WB<span class="op">$</span>Region &lt;-<span class="st"> </span><span class="kw">as.factor</span>(WB<span class="op">$</span>Region)</span>
<span id="cb331-4"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb331-4"></a>WB<span class="op">$</span>Income_group &lt;-<span class="st"> </span><span class="kw">as.factor</span>(WB<span class="op">$</span>Income_group)</span>
<span id="cb331-5"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb331-5"></a></span>
<span id="cb331-6"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb331-6"></a><span class="kw">str</span>(WB)</span>
<span id="cb331-7"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb331-7"></a><span class="st">&#39;data.frame&#39;</span><span class="op">:</span><span class="st">   </span><span class="dv">186</span> obs. of  <span class="dv">22</span> variables<span class="op">:</span></span>
<span id="cb331-8"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb331-8"></a><span class="st"> </span><span class="er">$</span><span class="st"> </span>Country_Name              <span class="op">:</span><span class="st"> </span>chr  <span class="st">&quot;Afghanistan&quot;</span> <span class="st">&quot;Angola&quot;</span> <span class="st">&quot;Albania&quot;</span> <span class="st">&quot;Andorra&quot;</span> ...</span>
<span id="cb331-9"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb331-9"></a> <span class="op">$</span><span class="st"> </span>Country_Code              <span class="op">:</span><span class="st"> </span>chr  <span class="st">&quot;AFG&quot;</span> <span class="st">&quot;AGO&quot;</span> <span class="st">&quot;ALB&quot;</span> <span class="st">&quot;AND&quot;</span> ...</span>
<span id="cb331-10"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb331-10"></a> <span class="op">$</span><span class="st"> </span>Region                    <span class="op">:</span><span class="st"> </span>Factor w<span class="op">/</span><span class="st"> </span><span class="dv">7</span> levels <span class="st">&quot;East Asia &amp; Pacific&quot;</span>,..<span class="op">:</span><span class="st"> </span><span class="dv">6</span> <span class="dv">7</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">4</span> <span class="dv">3</span> <span class="dv">2</span> <span class="dv">3</span> <span class="dv">1</span> <span class="dv">2</span> ...</span>
<span id="cb331-11"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb331-11"></a> <span class="op">$</span><span class="st"> </span>Income_group              <span class="op">:</span><span class="st"> </span>Factor w<span class="op">/</span><span class="st"> </span><span class="dv">4</span> levels <span class="st">&quot;High income&quot;</span>,..<span class="op">:</span><span class="st"> </span><span class="dv">2</span> <span class="dv">3</span> <span class="dv">4</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">4</span> <span class="dv">4</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> ...</span>
<span id="cb331-12"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb331-12"></a> <span class="op">$</span><span class="st"> </span>Population                <span class="op">:</span><span class="st"> </span>int  <span class="dv">33370794</span> <span class="dv">26941779</span> <span class="dv">2889104</span> <span class="dv">79213</span> <span class="dv">9214175</span> <span class="dv">42669500</span> <span class="dv">2912403</span> <span class="dv">92562</span> <span class="dv">23475686</span> <span class="dv">8546356</span> ...</span>
<span id="cb331-13"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb331-13"></a> <span class="op">$</span><span class="st"> </span>Land_area                 <span class="op">:</span><span class="st"> </span>num  <span class="dv">652860</span> <span class="dv">1246700</span> <span class="dv">27400</span> <span class="dv">470</span> <span class="dv">71020</span> ...</span>
<span id="cb331-14"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb331-14"></a> <span class="op">$</span><span class="st"> </span>Forest_area               <span class="op">:</span><span class="st"> </span>num  <span class="fl">2.07</span> <span class="fl">46.51</span> <span class="fl">28.19</span> <span class="fl">34.04</span> <span class="fl">4.53</span> ...</span>
<span id="cb331-15"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb331-15"></a> <span class="op">$</span><span class="st"> </span>Precipitation             <span class="op">:</span><span class="st"> </span>int  <span class="dv">327</span> <span class="dv">1010</span> <span class="dv">1485</span> <span class="ot">NA</span> <span class="dv">78</span> <span class="dv">591</span> <span class="dv">562</span> <span class="dv">1030</span> <span class="dv">534</span> <span class="dv">1110</span> ...</span>
<span id="cb331-16"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb331-16"></a> <span class="op">$</span><span class="st"> </span>Population_density        <span class="op">:</span><span class="st"> </span>num  <span class="fl">51.1</span> <span class="fl">21.6</span> <span class="fl">105.4</span> <span class="fl">168.5</span> <span class="fl">129.7</span> ...</span>
<span id="cb331-17"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb331-17"></a> <span class="op">$</span><span class="st"> </span>Capital_lat               <span class="op">:</span><span class="st"> </span>int  <span class="dv">33</span> <span class="dv">-13</span> <span class="dv">41</span> <span class="dv">43</span> <span class="dv">24</span> <span class="dv">-34</span> <span class="dv">40</span> <span class="dv">17</span> <span class="dv">-35</span> <span class="dv">47</span> ...</span>
<span id="cb331-18"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb331-18"></a> <span class="op">$</span><span class="st"> </span>GNP_per_Cap               <span class="op">:</span><span class="st"> </span>int  <span class="dv">630</span> <span class="dv">5010</span> <span class="dv">4540</span> <span class="ot">NA</span> <span class="dv">44330</span> <span class="dv">12350</span> <span class="dv">4140</span> <span class="dv">12730</span> <span class="dv">65150</span> <span class="dv">50370</span> ...</span>
<span id="cb331-19"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb331-19"></a> <span class="op">$</span><span class="st"> </span>Population_growth         <span class="op">:</span><span class="st"> </span>num  <span class="fl">3.356</span> <span class="fl">3.497</span> <span class="fl">-0.207</span> <span class="fl">-1.951</span> <span class="fl">0.177</span> ...</span>
<span id="cb331-20"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb331-20"></a> <span class="op">$</span><span class="st"> </span>Cereal_yield              <span class="op">:</span><span class="st"> </span>num  <span class="dv">2018</span> <span class="dv">888</span> <span class="dv">4893</span> <span class="ot">NA</span> <span class="dv">12543</span> ...</span>
<span id="cb331-21"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb331-21"></a> <span class="op">$</span><span class="st"> </span>Under_<span class="dv">5</span>_mortality         <span class="op">:</span><span class="st"> </span>num  <span class="fl">73.6</span> <span class="fl">92.9</span> <span class="dv">10</span> <span class="fl">3.4</span> <span class="fl">7.9</span> <span class="dv">12</span> <span class="fl">15.1</span> <span class="fl">7.6</span> <span class="dv">4</span> <span class="fl">3.8</span> ...</span>
<span id="cb331-22"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb331-22"></a> <span class="op">$</span><span class="st"> </span>Renewables                <span class="op">:</span><span class="st"> </span>num  <span class="fl">19.314</span> <span class="fl">50.797</span> <span class="fl">38.69</span> <span class="fl">19.886</span> <span class="fl">0.146</span> ...</span>
<span id="cb331-23"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb331-23"></a> <span class="op">$</span><span class="st"> </span>CO2                       <span class="op">:</span><span class="st"> </span>num  <span class="fl">0.294</span> <span class="fl">1.29</span> <span class="fl">1.979</span> <span class="fl">5.833</span> <span class="fl">22.94</span> ...</span>
<span id="cb331-24"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb331-24"></a> <span class="op">$</span><span class="st"> </span>PM25                      <span class="op">:</span><span class="st"> </span>num  <span class="dv">59</span> <span class="dv">33</span> <span class="fl">18.9</span> <span class="fl">10.8</span> <span class="dv">38</span> ...</span>
<span id="cb331-25"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb331-25"></a> <span class="op">$</span><span class="st"> </span>Women_in_parliament       <span class="op">:</span><span class="st"> </span>num  <span class="fl">27.7</span> <span class="fl">36.8</span> <span class="dv">20</span> <span class="dv">50</span> <span class="fl">17.5</span> <span class="fl">36.6</span> <span class="fl">10.7</span> <span class="fl">11.1</span> <span class="dv">26</span> <span class="fl">32.2</span> ...</span>
<span id="cb331-26"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb331-26"></a> <span class="op">$</span><span class="st"> </span>GINI_index                <span class="op">:</span><span class="st"> </span>num  <span class="ot">NA</span> <span class="ot">NA</span> <span class="ot">NA</span> <span class="ot">NA</span> <span class="ot">NA</span> <span class="fl">41.7</span> <span class="fl">31.5</span> <span class="ot">NA</span> <span class="fl">35.8</span> <span class="fl">30.5</span> ...</span>
<span id="cb331-27"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb331-27"></a> <span class="op">$</span><span class="st"> </span>Govt_spend_education      <span class="op">:</span><span class="st"> </span>num  <span class="fl">3.7</span> <span class="ot">NA</span> <span class="ot">NA</span> <span class="dv">3</span> <span class="ot">NA</span> ...</span>
<span id="cb331-28"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb331-28"></a> <span class="op">$</span><span class="st"> </span>Secondary_school_enrolment<span class="op">:</span><span class="st"> </span>num  <span class="fl">52.6</span> <span class="ot">NA</span> <span class="fl">97.7</span> <span class="ot">NA</span> <span class="ot">NA</span> ...</span>
<span id="cb331-29"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb331-29"></a> <span class="op">$</span><span class="st"> </span>School_gender_parity      <span class="op">:</span><span class="st"> </span>num  <span class="fl">0.654</span> <span class="ot">NA</span> <span class="fl">0.977</span> <span class="ot">NA</span> <span class="ot">NA</span> ...</span></code></pre></div>
<p>Let’s say that we’re interested in how PM25 pollution varies between income groups. We can calculate the mean PM25 pollution and also the 95% Confidence intervals of the means using <code>tapply()</code>:</p>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb332-1"></a></span>
<span id="cb332-2"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb332-2"></a><span class="co"># Put levels of income group in order</span></span>
<span id="cb332-3"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb332-3"></a>WB<span class="op">$</span>Income_group &lt;-<span class="st"> </span><span class="kw">factor</span>(</span>
<span id="cb332-4"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb332-4"></a>  WB<span class="op">$</span>Income_group,</span>
<span id="cb332-5"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb332-5"></a>  <span class="dt">levels =</span> <span class="kw">c</span>(</span>
<span id="cb332-6"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb332-6"></a>    <span class="st">&quot;Low income&quot;</span>,</span>
<span id="cb332-7"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb332-7"></a>    <span class="st">&quot;Lower middle income&quot;</span>,</span>
<span id="cb332-8"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb332-8"></a>    <span class="st">&quot;Upper middle income&quot;</span>,</span>
<span id="cb332-9"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb332-9"></a>    <span class="st">&quot;High income&quot;</span></span>
<span id="cb332-10"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb332-10"></a>  )</span>
<span id="cb332-11"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb332-11"></a>)</span>
<span id="cb332-12"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb332-12"></a></span>
<span id="cb332-13"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb332-13"></a><span class="co">#means</span></span>
<span id="cb332-14"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb332-14"></a>meanPM25 &lt;-<span class="st"> </span><span class="kw">tapply</span>(WB<span class="op">$</span>PM25, WB<span class="op">$</span>Income_group, mean)</span>
<span id="cb332-15"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb332-15"></a></span>
<span id="cb332-16"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb332-16"></a><span class="kw">names</span>(meanPM25) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Low&quot;</span>, <span class="st">&quot;Lower middle&quot;</span>, <span class="st">&quot;Upper middle&quot;</span>, <span class="st">&quot;High&quot;</span>)</span>
<span id="cb332-17"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb332-17"></a></span>
<span id="cb332-18"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb332-18"></a><span class="co">#function to calculate 95% CIs</span></span>
<span id="cb332-19"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb332-19"></a>meanci &lt;-<span class="st"> </span><span class="cf">function</span>(X1) {</span>
<span id="cb332-20"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb332-20"></a>    lenX1 &lt;-<span class="st"> </span><span class="kw">length</span>(X1)</span>
<span id="cb332-21"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb332-21"></a>    X195 &lt;-<span class="st"> </span><span class="kw">qt</span>(<span class="fl">0.975</span>, <span class="dt">df =</span> lenX1 <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">var</span>(X1))<span class="op">/</span><span class="kw">sqrt</span>(lenX1)</span>
<span id="cb332-22"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb332-22"></a>    output &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">Lower.CI =</span> <span class="kw">mean</span>(X1) <span class="op">-</span><span class="st"> </span>X195, <span class="dt">Upper.CI =</span> <span class="kw">mean</span>(X1) <span class="op">+</span><span class="st"> </span>X195)</span>
<span id="cb332-23"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb332-23"></a>    <span class="kw">return</span>(output)</span>
<span id="cb332-24"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb332-24"></a>}</span>
<span id="cb332-25"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb332-25"></a></span>
<span id="cb332-26"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb332-26"></a></span>
<span id="cb332-27"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb332-27"></a></span>
<span id="cb332-28"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb332-28"></a><span class="co">#95% CIs</span></span>
<span id="cb332-29"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb332-29"></a>PM25CIs &lt;-<span class="st"> </span><span class="kw">tapply</span>(WB<span class="op">$</span>PM25, WB<span class="op">$</span>Income_group, meanci)</span>
<span id="cb332-30"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb332-30"></a></span>
<span id="cb332-31"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb332-31"></a></span>
<span id="cb332-32"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb332-32"></a><span class="co">#Generate matrix from list</span></span>
<span id="cb332-33"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb332-33"></a>PM25CIs2 &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">unlist</span>(PM25CIs), <span class="dt">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb332-34"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb332-34"></a><span class="kw">rownames</span>(PM25CIs2) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Lower&quot;</span>, <span class="st">&quot;Upper&quot;</span>)</span>
<span id="cb332-35"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb332-35"></a><span class="kw">colnames</span>(PM25CIs2) &lt;-<span class="st"> </span><span class="kw">names</span>(meanPM25)</span>
<span id="cb332-36"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb332-36"></a></span>
<span id="cb332-37"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb332-37"></a><span class="co">#Check data</span></span>
<span id="cb332-38"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb332-38"></a>meanPM25</span>
<span id="cb332-39"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb332-39"></a>         Low Lower middle Upper middle         High </span>
<span id="cb332-40"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb332-40"></a>      <span class="fl">37.421</span>       <span class="fl">32.298</span>       <span class="fl">24.477</span>       <span class="fl">17.677</span> </span>
<span id="cb332-41"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb332-41"></a>PM25CIs2</span>
<span id="cb332-42"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb332-42"></a>         Low Lower middle Upper middle   High</span>
<span id="cb332-43"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb332-43"></a>Lower <span class="fl">31.215</span>       <span class="fl">27.242</span>       <span class="fl">21.553</span> <span class="fl">13.973</span></span>
<span id="cb332-44"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb332-44"></a>Upper <span class="fl">43.628</span>       <span class="fl">37.354</span>       <span class="fl">27.401</span> <span class="fl">21.381</span></span></code></pre></div>
<p>R doesn’t have a built in function to calculate confidence intervals so I’ve put in a bit of code to do this. Don’t worry about this too much: the whole thing is explained in the chapter on programming in R. For the moment you just need to know that it’s calculating the 95% confidence intervals. There’s some other code there as well: firstly, at the start, the bit where we specify the levels of <code>WB$Income_group</code> in order from poorer to richer. YOu saw this in the last chapter and it just makes the final graph make more sense. Secondly there is some code towards the end to convert the output of the second <code>tapply()</code> to a matrix from the list which <code>tapply()</code> generates. What we end up with is a vector of our mean values (<code>meanPM25</code>) and a matrix of our upper and lower confidence intervals (<code>PM25CIs2</code>). We can use the first of these to draw our barplot and the second to add error bars. Let’s do that.</p>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb333-1"></a></span>
<span id="cb333-2"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb333-2"></a><span class="co">#Generate locations of the centres of the bars</span></span>
<span id="cb333-3"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb333-3"></a>ticks &lt;-<span class="st"> </span><span class="kw">barplot</span>(meanPM25, <span class="dt">plot =</span> <span class="ot">FALSE</span>)</span>
<span id="cb333-4"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb333-4"></a></span>
<span id="cb333-5"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb333-5"></a><span class="co">#Plot the graph</span></span>
<span id="cb333-6"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb333-6"></a><span class="kw">barplot</span>(meanPM25,</span>
<span id="cb333-7"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb333-7"></a>        <span class="dt">col =</span> <span class="st">&quot;cadetblue4&quot;</span>,</span>
<span id="cb333-8"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb333-8"></a>        <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">45</span>),</span>
<span id="cb333-9"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb333-9"></a>        <span class="dt">xlab =</span> <span class="st">&quot;Income group&quot;</span>,</span>
<span id="cb333-10"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb333-10"></a>        <span class="dt">ylab =</span> <span class="st">&quot;Mean PM25 pollution&quot;</span>,</span>
<span id="cb333-11"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb333-11"></a>        <span class="dt">font.lab =</span> <span class="dv">2</span>,</span>
<span id="cb333-12"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb333-12"></a>        <span class="dt">xaxt =</span> <span class="st">&quot;n&quot;</span>)</span>
<span id="cb333-13"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb333-13"></a></span>
<span id="cb333-14"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb333-14"></a><span class="co">#Add error bars</span></span>
<span id="cb333-15"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb333-15"></a><span class="kw">arrows</span>(<span class="dt">x0 =</span> ticks, </span>
<span id="cb333-16"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb333-16"></a>       <span class="dt">y0 =</span> PM25CIs2[<span class="dv">1</span>,], </span>
<span id="cb333-17"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb333-17"></a>       <span class="dt">x1 =</span> ticks, </span>
<span id="cb333-18"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb333-18"></a>       <span class="dt">y1 =</span> PM25CIs2[<span class="dv">2</span>,],</span>
<span id="cb333-19"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb333-19"></a>       <span class="dt">length =</span> <span class="fl">0.05</span>,</span>
<span id="cb333-20"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb333-20"></a>       <span class="dt">angle =</span> <span class="dv">90</span>,</span>
<span id="cb333-21"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb333-21"></a>       <span class="dt">code =</span> <span class="dv">3</span>)</span>
<span id="cb333-22"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb333-22"></a></span>
<span id="cb333-23"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb333-23"></a><span class="co">#Add x axis</span></span>
<span id="cb333-24"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb333-24"></a><span class="kw">axis</span>(<span class="dt">side =</span> <span class="dv">1</span>, </span>
<span id="cb333-25"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb333-25"></a>     <span class="dt">at =</span> ticks, </span>
<span id="cb333-26"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb333-26"></a>     <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Low</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="st">&quot;Lower</span><span class="ch">\n</span><span class="st">middle&quot;</span>,<span class="st">&quot;Upper</span><span class="ch">\n</span><span class="st">middle&quot;</span>,<span class="st">&quot;High</span><span class="ch">\n</span><span class="st">&quot;</span>),</span>
<span id="cb333-27"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb333-27"></a>     <span class="dt">padj =</span> <span class="fl">0.3</span>)</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-328"></span>
<img src="3rd_Edition_files/figure-html/unnamed-chunk-328-1.png" alt="Barplot of mean PM25 data with 95% confidence interval error bars drawn using arrows()" width="672" />
<p class="caption">
Figure 10.21: Barplot of mean PM25 data with 95% confidence interval error bars drawn using arrows()
</p>
</div>
<p>There’s a goodly amount of code going into generating this graph, so let’s go through it and see what it all does.</p>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb334-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb334-1"></a><span class="co">#Generate locations of the centres of the bars</span></span>
<span id="cb334-2"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb334-2"></a>ticks &lt;-<span class="st"> </span><span class="kw">barplot</span>(meanPM25, <span class="dt">plot =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p>You might remember that when we’re plotting a bar graph the locations of the centres of the bars are not usually obvious. We need to know these locations for when we tell R to draw our error bars, and we also need to know them because we’re going to make something nicer and neater than the default x axis. This line saves these locations in an object called <code>ticks</code>.</p>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb335-1"></a><span class="co">#Plot the graph</span></span>
<span id="cb335-2"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb335-2"></a><span class="kw">barplot</span>(meanPM25,</span>
<span id="cb335-3"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb335-3"></a>        <span class="dt">col =</span> <span class="st">&quot;cadetblue4&quot;</span>,</span>
<span id="cb335-4"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb335-4"></a>        <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">45</span>),</span>
<span id="cb335-5"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb335-5"></a>        <span class="dt">xlab =</span> <span class="st">&quot;Income group&quot;</span>,</span>
<span id="cb335-6"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb335-6"></a>        <span class="dt">ylab =</span> <span class="st">&quot;Mean PM25 pollution&quot;</span>,</span>
<span id="cb335-7"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb335-7"></a>        <span class="dt">font.lab =</span> <span class="dv">2</span>,</span>
<span id="cb335-8"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb335-8"></a>        <span class="dt">xaxt =</span> <span class="st">&quot;n&quot;</span>)</span></code></pre></div>
<p>This draws the bar graph itself using the <code>barplot()</code> function. Most of this should be familiar but there are a few important points to look at.Firstly <code>ylim = c(0,45)</code>: if we didn’t specify the y-axis limits then the graph swould be plotted so that the bars fitted nicely, meaning that the tops of our error bars would go outside the plot area and be lost. Secondly <code>font.lab = 2</code> means that the axis labels will be in a bold font. Finally, <code>xaxt = "n"</code> means that the graph will be plotted without anything for the x-axis — we’ll add all of that later.</p>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb336-1"></a><span class="co">#Add error bars</span></span>
<span id="cb336-2"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb336-2"></a><span class="kw">arrows</span>(<span class="dt">x0 =</span> ticks, </span>
<span id="cb336-3"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb336-3"></a>       <span class="dt">y0 =</span> PM25CIs2[<span class="dv">1</span>,], </span>
<span id="cb336-4"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb336-4"></a>       <span class="dt">x1 =</span> ticks, </span>
<span id="cb336-5"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb336-5"></a>       <span class="dt">y1 =</span> PM25CIs2[<span class="dv">2</span>,],</span>
<span id="cb336-6"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb336-6"></a>       <span class="dt">length =</span> <span class="fl">0.05</span>,</span>
<span id="cb336-7"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb336-7"></a>       <span class="dt">angle =</span> <span class="dv">90</span>,</span>
<span id="cb336-8"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb336-8"></a>       <span class="dt">code =</span> <span class="dv">3</span>)</span></code></pre></div>
<p>This is where the magic happens… or at least where we add the error bars. The trick here is to take advantage of the flexibility of <code>arrows()</code>, which lets us draw arrows with heads at each end of the line and to specify the angle of the lines making the arrowhead as well. If we draw a vertical line with an arrowhead at each end, and we make the angle between the lines making the arrow and the main line 90^o, that will look like a traditional error bar with a straight “cap” at each end. Let’s go through this in more detail.</p>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb337-1"></a><span class="kw">arrows</span>(<span class="dt">x0 =</span> ticks, </span>
<span id="cb337-2"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb337-2"></a>       <span class="dt">y0 =</span> PM25CIs2[<span class="dv">1</span>,], </span>
<span id="cb337-3"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb337-3"></a>       <span class="dt">x1 =</span> ticks, </span>
<span id="cb337-4"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb337-4"></a>       <span class="dt">y1 =</span> PM25CIs2[<span class="dv">2</span>,],</span></code></pre></div>
<p>This is telling <code>arrows()</code> where to draw the arrows from and to. As we saw in section 10.6, <code>arrows()</code> takes four arguments which give it the x- and y- coordinates in the plot area where the arrows being drawn should start and finish. These are <code>x0</code>, <code>y0</code>, <code>x1</code> and <code>y1</code>. For our purposes here we want the arrows to be vertical so the <code>x0</code> and <code>x1</code> values are the same: the midpoints of the bars which we extracted earlier and saved as the object <code>ticks</code>. The y-coordinates of the bottom of the error bars are the values for the lower 95% confidence intervals and we have these as the top row of the matrix <code>PM25CIs2</code> which we extract using a subscript. The y-coordinates for the tops of the error bars are the second row of that matrix and we get those values using a subscript as well.</p>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb338-1"></a>       length =<span class="st"> </span><span class="fl">0.05</span>,</span>
<span id="cb338-2"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb338-2"></a>       angle =<span class="st"> </span><span class="dv">90</span>,</span>
<span id="cb338-3"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb338-3"></a>       code =<span class="st"> </span><span class="dv">3</span><span class="er">)</span></span></code></pre></div>
<p>These three arguments finish off our <code>arrows()</code> function call and make sure that we have nice looking error bars. <code>length = 0.05</code> specifies the length of the lines making up the arrowhead (not the length of the arrow overall) and here we’re making them rather short to give small ‘caps’ on the ends of the error bars. <code>angle = 90</code> sets the angle between the lines making up the arrowheads and the main line. By sepcifying 90<sup>o</sup> we’re making sure that the “cap” on the error bar is a straight line perpendicular to the main error bar line. Finally <code>code = 3</code> tells <code>arrows()</code> to draw an arrowhead (or in this case a “cap”) at each end of the line.</p>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb339-1"></a><span class="co">#Add x axis</span></span>
<span id="cb339-2"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb339-2"></a><span class="kw">axis</span>(<span class="dt">side =</span> <span class="dv">1</span>, </span>
<span id="cb339-3"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb339-3"></a>     <span class="dt">at =</span> ticks, </span>
<span id="cb339-4"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb339-4"></a>     <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Low</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="st">&quot;Lower</span><span class="ch">\n</span><span class="st">middle&quot;</span>,<span class="st">&quot;Upper</span><span class="ch">\n</span><span class="st">middle&quot;</span>,<span class="st">&quot;High</span><span class="ch">\n</span><span class="st">&quot;</span>), </span>
<span id="cb339-5"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb339-5"></a>     <span class="dt">padj =</span> <span class="fl">0.3</span>)</span></code></pre></div>
<p>Here, we draw in the x-axis which we asked to be left out in the <code>barplot()</code> call. <code>side = 1</code> tells <code>axis()</code> to draw it on the bottom side of the plot, and <code>at = ticks</code> tells it where to put things: in this case both the tickmarks and the axis text. <code>labels =</code> gives it a vector of character data to be written in at the tickpoints. The actual character vector needs a little explanation. Rathed than turn the text on its side to fit it in, like we did in section 9.8, here I’m splitting the text over multiple lines. That’s what the <code>\n</code> text in the vector does: <code>\</code> is an <em>escape character</em> meaing that it isn’t processed as normal text in a character vector but does something else, and <code>\n</code> means “put a new line in here”. This is what gives us the nicely formatted text on the x-axis of our plot. You might wonder why we need these <code>\n</code> characters in the elements that only need a single line such as <code>"Low\n"</code>: the answer is that without them these words get written on the bottom of the two lines we’re using and it doesn’t look so nice. Try it. <code>padj = 0.3</code> (<strong>p</strong>erpendicular <strong>adj</strong>ustment) moves the text down a little because otherwise it gets mixed up with the tick marks.</p>
</div>
<div id="plotting-means-and-error-bars-using-plotmeans" class="section level3">
<h3><span class="header-section-number">10.7.2</span> Plotting means and error bars using <code>plotmeans()</code></h3>
<p>A second option to plot means and confidence intervals is to is to install the package called <code>gplots</code> (see the chapter on R packages for more on this), which has a handy function called <code>plotmeans()</code>. This makes things a fair</p>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb340-1"></a><span class="kw">install.packages</span>(<span class="st">&quot;gplots&quot;</span>)</span>
<span id="cb340-2"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb340-2"></a><span class="kw">library</span>(gplots)</span></code></pre></div>
<p>This is what the default output looks like: plotmeans will calculate means and confidence intervals for you so you just need to feed it the raw data.</p>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb341-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb341-1"></a><span class="kw">plotmeans</span>(WB<span class="op">$</span>PM25<span class="op">~</span>WB<span class="op">$</span>Income_group)</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-337"></span>
<img src="3rd_Edition_files/figure-html/unnamed-chunk-337-1.png" alt="Default output from `plotmeans()`." width="672" />
<p class="caption">
Figure 10.22: Default output from <code>plotmeans()</code>.
</p>
</div>
<p>OK, it’s plotted the means and the 95% confidence limits, and this is a useful plot to just have a look at our data with. Nevertheless, we could improve quite a few things before we start thinking about adding this particular graphic to our latest submission to Nature. The helpful indicators of sample size and the line connecting the means could do with being lost. The points for the means might be better if they were bigger, and the error bars could go in black instead of blue. To find out how to sort all of these issues out, take a look at the help file.</p>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb342-1"></a><span class="kw">plotmeans</span>(WB<span class="op">$</span>PM25 <span class="op">~</span><span class="st"> </span>WB<span class="op">$</span>Income_group, </span>
<span id="cb342-2"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb342-2"></a>          <span class="dt">connect=</span><span class="ot">FALSE</span>, </span>
<span id="cb342-3"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb342-3"></a>          <span class="dt">barcol=</span><span class="st">&#39;black&#39;</span>, </span>
<span id="cb342-4"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb342-4"></a>          <span class="dt">pch=</span><span class="dv">16</span>, </span>
<span id="cb342-5"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb342-5"></a>          <span class="dt">cex=</span><span class="fl">1.5</span>, </span>
<span id="cb342-6"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb342-6"></a>          <span class="dt">n.label=</span><span class="ot">FALSE</span>, </span>
<span id="cb342-7"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb342-7"></a>          <span class="dt">ylab=</span><span class="st">&quot;Mean PM25 pollution&quot;</span>,</span>
<span id="cb342-8"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb342-8"></a>          <span class="dt">xlab =</span> <span class="st">&quot;Income group&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-338"></span>
<img src="3rd_Edition_files/figure-html/unnamed-chunk-338-1.png" alt="Nicer looking graph with 95% CIs" width="672" />
<p class="caption">
Figure 10.23: Nicer looking graph with 95% CIs
</p>
</div>
<p>Still needs a bit of a tweak: the x-axis labels are not working so let’s fix that using <code>axis()</code> as we did previously, and we can make the axis titles bold as well.</p>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb343-1"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb343-1"></a><span class="kw">plotmeans</span>(WB<span class="op">$</span>PM25 <span class="op">~</span><span class="st"> </span>WB<span class="op">$</span>Income_group, </span>
<span id="cb343-2"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb343-2"></a>          <span class="dt">connect=</span><span class="ot">FALSE</span>, </span>
<span id="cb343-3"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb343-3"></a>          <span class="dt">barcol=</span><span class="st">&#39;black&#39;</span>, </span>
<span id="cb343-4"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb343-4"></a>          <span class="dt">pch=</span><span class="dv">16</span>, </span>
<span id="cb343-5"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb343-5"></a>          <span class="dt">cex=</span><span class="fl">1.5</span>, </span>
<span id="cb343-6"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb343-6"></a>          <span class="dt">n.label=</span><span class="ot">FALSE</span>, </span>
<span id="cb343-7"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb343-7"></a>          <span class="dt">ylab=</span><span class="st">&quot;Mean PM25 pollution&quot;</span>,</span>
<span id="cb343-8"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb343-8"></a>          <span class="dt">xlab =</span> <span class="st">&quot;Income group&quot;</span>,</span>
<span id="cb343-9"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb343-9"></a>          <span class="dt">xaxt =</span> <span class="st">&quot;n&quot;</span>,</span>
<span id="cb343-10"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb343-10"></a>          <span class="dt">font.lab =</span> <span class="dv">2</span>)</span>
<span id="cb343-11"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb343-11"></a></span>
<span id="cb343-12"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb343-12"></a><span class="kw">axis</span>(<span class="dt">side =</span> <span class="dv">1</span>, </span>
<span id="cb343-13"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb343-13"></a>     <span class="dt">at =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, </span>
<span id="cb343-14"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb343-14"></a>     <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Low</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="st">&quot;Lower</span><span class="ch">\n</span><span class="st">middle&quot;</span>,<span class="st">&quot;Upper</span><span class="ch">\n</span><span class="st">middle&quot;</span>,<span class="st">&quot;High</span><span class="ch">\n</span><span class="st">&quot;</span>), </span>
<span id="cb343-15"><a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#cb343-15"></a>     <span class="dt">padj =</span> <span class="fl">0.3</span>)</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-339"></span>
<img src="3rd_Edition_files/figure-html/unnamed-chunk-339-1.png" alt="Nicer looking graph with 95% CIs" width="672" />
<p class="caption">
Figure 10.24: Nicer looking graph with 95% CIs
</p>
</div>
<p>What I’ve done here is add <code>xaxt = "n"</code> and <code>font.lab = 2</code> to the <code>plotmeans()</code> function call, suppressing the x-axis and making the axis titles bold. I’ve then used the same <code>axis()</code> code as before except because the <code>at =</code> argument which tells it where the ticks go now just needs <code>1:4</code> because things in that respect at least are a bit more sensible with this plot.</p>

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="12">
<li id="fn12"><p>Yes, we can do this, and we can also tell <code>lines()</code> to draw points — both of them take the <code>type =</code> argument and can produce the full range of options: you can read about these in the help file for <code>plot.default</code>.<a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#fnref12" class="footnote-back">↩︎</a></p></li>
<li id="fn13"><p>This is me trying to make the fact that I’ve used an unnecessarily complicated example seem a virtue.<a href="r-graphics-ii-adding-elements-to-an-existing-graph.html#fnref13" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="r-graphics-i-drawing-graphs-and-changing-plot-symbols-and-colours-using-the-base-graphics-system.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="graphics-with-ggplot2.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["3rd_Edition.pdf", "3rd_Edition.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
